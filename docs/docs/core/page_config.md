# 页面配置

## 配置对象解析

页面配置是个对象，形如：

```js
'pageName': {
    name: '页面1',
    layout: 'default',
    widgets: [],
    inherit: []
}
```

该对象的每一个属性代表一个页面配置，属性名是页面的唯一标识符

**name**

页面的名称，通常是用户友好的正式称谓，可选项

**layout**

页面的布局，默认是 default，可选项

**widgets**

页面上的部件，它是一个数组，数组的每一项是一个参数对象，形如：

```js
widgets: [{
    name: 'widget1',
    options: {
        _source: 'basic',  // 源
        host: '.v-render-body'  // 宿主元素
    }
}]
```

这个参数对象中的 options 根据实际部件自身的需要可传入任意的字段，这个由部件本身决定，但部件的配置应该包含基本的三个要素：

* 部件名称（必须）
* 部件源（可选项，默认部件源为 basic）
* 宿主元素（可选项，默认宿主元素为 .v-render-body）

如果一个部件的配置参数仅包含这三个属性，那么可以使用配置字符串格式进行配置，形如：

```js
widgets: ['widget1@.v-render-body@.basic']
```

这个写法与上面使用对象的写法等价，在使用默认配置的情况下，可以省略源，也可以全部省略

```js
widgets: ['widget1@.v-render-body']
widgets: ['widget1']
```

以上几种写法最终效果是一致的。

## 关于源的查找

默认会从名为 basic 的源中查找部件，如果项目中没有为 basic 源配置路径，那么将使用的默认的路径：当前基路径下的 widgets 目录

## 关于应用程序根元素

类名为 `v-app-root` 的元素是应用程序的默认根元素，也是所有部件的默认宿主对象，所有部件在没有配置宿主元素（host）时，会添加到它的子级，这个元素是应用程序启动后，进行布局初始化的时候创建的：

* scaffold

```html
<div class="v-app-root"></div>
```

默认情况下，应用程序根元素是 body 元素下的一个子元素，你可以通过重写默认的布局：scaffold，来改变该默认根元素的外观或位置。

应用程序根元素同时也是布局切换的根元素，当切换布局时，会清除掉应用程序根元素下的所有元素，用新的布局文件模板替代，在新的布局模版下，再进行部件渲染。

## 关于页面继承

一个页面可以继承其他页面的 widgets 配置，使用 inherit 字段配置，形如：

```js
'page': {
    inherit: ['page1', 'page2']
}
```

页面会继承该数组中的所有页面的 widgets 配置，对于相同的部件，写在后面的定义会覆盖前面的配置；默认所有的页面会继承名为 _common 的页面，你可以通过定义它来实现所有页面共有的一些 widget。


## 页面切换时的工作

调用 `app.page.change` 方法进行页面切换，切换时，首先识别当前页面和即将切换的页面是否是同一个布局方案，如果是则直接进行页面的切换，如果不是，则会首先进行布局切换，再进行页面切换。

在识别页面的过程中，会根据页面标识符查找页面配置，并通过页面配置加载不同的部件，如果没找到，会识别该标识符是否是一个路径，如果是一个有效的路径，则会尝试从后台该路径中获取页面配置，如果获取到的配置是一个有效的JSON对象，则使用，否则如果是一段有效的HTML，则会将它替换当前的应用程序根，并进行页面解析；以上路径都不成立时，则发送 pageNotFound 的消息

页面切换时，会进行新旧页面的 widgets 集合对比，销毁新页面中不存在的部件，保留相同的部件，在页面上添加上新增的部件。而相同部件的定义是：相同名称，并且是相同宿主元素的部件被认为是同一个部件。
