!function(a,b){"function"==typeof define&&define.amd?define(["jquery","lodash"],b):a.veronica=b(a.$,a._)}(this,function(a,b){var c,d,e;return function(a){function b(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b&&b.split("/"),p=s.map,q=p&&p["*"]||{};if(a){for(a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),"."===a[0].charAt(0)&&o&&(n=o.slice(0,o.length-1),a=n.concat(a)),k=0;k<a.length;k++)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(0===k||1===k&&".."===a[2]||".."===a[k-1])continue;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((o||q)&&p){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),o)for(l=o.length;l>0;l-=1)if(e=p[o.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||c,"undefined"===v||"function"===v){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[c],u):void 0,c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},c=d=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},c._defined=q,e=function(a,c,d){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},e.amd={jQuery:!0}}(),e("../node_modules/almond/almond",function(){}),!function(a,b,c){"function"==typeof e?e("base/class",c):"undefined"!=typeof module?module.exports=c():b[a]=c()}("klass",this,function(){function a(a){return a instanceof Date||a instanceof RegExp}function b(a){if(a instanceof Buffer){var b=new Buffer(a.length);return a.copy(b),b}if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);throw new Error("Unexpected situation")}function c(d){var e=[];return d.forEach(function(d,f){"object"==typeof d&&null!==d?Array.isArray(d)?e[f]=c(d):a(d)?e[f]=b(d):e[f]=k({},d):e[f]=d}),e}function d(a){var b=e(a)?a:function(){};return j.call(b,a,1)}function e(a){return typeof a===l}function f(a,b,c){return function(){var d=this.supr;this.supr=c.prototype[a];var e={}.fabricatedUndefined,f=e;try{f=b.apply(this,arguments)}finally{this.supr=d}return f}}function g(a,b){return function(){a.apply(this,Array.prototype.slice.call(arguments)),b.apply(this,Array.prototype.slice.call(arguments))}}function h(a,b,c,d,e){if(e||(e={}),e.merge||(e.merge=[]),e.initPropsMethod||(e.initPropsMethod="_initProps"),d.options&&k(a.options,d.options),d.configs&&k(a,d.configs),d.methods&&i(b,d.methods,c,e.merge),d.props){var f={},g=d.props;f[e.initPropsMethod]=function(){var a=this;for(var b in g)a[b]=g[b]},i(b,f,c,[e.initPropsMethod])}}function i(a,b,c,d){d||(d=[]);for(var h in b)if(b.hasOwnProperty(h))if(null!=b[h]&&"object"==typeof b[h])a[h]=k({},c.prototype[h],a[h],b[h]);else{var i=b[h];e(b[h])&&(e(c.prototype[h])&&m.test(b[h])&&(i=f(h,b[h],c)),e(a[h])&&d.indexOf(h)>=0&&(i=g(a[h],i))),a[h]=i}}function j(a,b){function c(){}function d(){this.initialize?this.initialize.apply(this,arguments):(!b&&k&&f.apply(this,arguments),l.apply(this,arguments))}c.prototype=this.prototype;var f=this,g=new c,k=e(a),l=k?a:this,m=k?{}:a;return d.methods=function(a,b){return i(g,a,f,b),d.prototype=g,this},d.methods(m),d.prototype.constructor=d,d.extend=j,d.statics=function(a,b){return"string"==typeof a&&(a=function(){var c={};return c[a]=b,c}()),i(this,a,f),this},d.prototype.implement=d.statics,d.members=function(a,b){return h(g,g,f,a,b),d.prototype=g,this},d}var k=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var d,e,f=arguments[0],g=Array.prototype.slice.call(arguments,1);return g.forEach(function(g){"object"!=typeof g||Array.isArray(g)||Object.keys(g).forEach(function(h){return e=f[h],d=g[h],d===f?void 0:"object"!=typeof d||null===d?void(f[h]=d):Array.isArray(d)?void(f[h]=c(d)):a(d)?void(f[h]=b(d)):"object"!=typeof e||null===e||Array.isArray(e)?void(f[h]=k({},d)):void(f[h]=k(e,d))})}),f},l="function",m=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/;return d}),e("base/lodashExt/querystring",["lodash","../class"],function(a,b){var c=b(function(a){null==a&&(a=1),this.choice=a}).methods({_qsToJSON:function(b){b||(b=location.search);var c=/([^\?]*)\?([^\?]+)/.exec(b);null!=c&&(b=c[2]);var d=b.split("&"),e={};return a.each(d,function(a){a=a.split("="),e[a[0]]=decodeURIComponent(a[1]||"")}),JSON.parse(JSON.stringify(e))},_updateQueryString:function(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=a.indexOf("?")!==-1?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c},_getUrl:function(){var a=this.choice;return 0===this.choice&&(a=window.location.search),1===this.choice&&(a=window.location.hash),a},_setUrl:function(a){1===this.choice&&(window.location.hash=a),0===this.choice&&(window.location.search=a)},set:function(b,c){var d=this._getUrl(),e=this;return a.isObject(b)?a.each(b,function(a,b){d=e._updateQueryString(d,b,a)}):d=e._updateQueryString(d,b,c),this._setUrl(d),d},get:function(a){var b=this._getUrl();a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(b);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},toJSON:function(b){var c=this._getUrl();null==b&&(b=!1);var d,e;return d=this._qsToJSON(c),b&&(e=this._qsToJSON(window.location.search)),a.extend({},e,d)}});a.qs||(a.qs=function(a){return new c(a)})}),e("base/lodashExt/request",["lodash","jquery"],function(a,b){var c={};c.get=function(a,c){return b.get(a,c)},c.getJSON=function(a,c){return b.getJSON(a,c)},c.getComplex=function(a,c,d){return d||(d={}),b.ajax(b.extend({url:a,type:"GET",contentType:"application/json",data:JSON.stringify(c)},d))},c.post=function(a,c){return b.post(a,c)},c.postComplex=function(a,c,d){return b.ajax(b.extend({url:a,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(c)},d))},c.getBundle=function(){var c=Array.prototype.slice.call(arguments),d=b.map(c,function(c){return a.isString(c)?b.get(c):c.done?c:b.get(c.url,c.data)});return a.whenAjax.apply(a,d)};var d=function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("chrome")>=0&&window.externalHost};return c.download=function(c){c||(c={}),void 0!=c.url&&(a.isString(c.data)||(c.data=b.param(c.data,!0)),d()?window.open(c.url+"?"+c.data,"newwindow"):(0===b("#global-download-iframe").length&&b('<iframe id="global-download-iframe" src="" style="width:0;height:0;display: inherit;border:0;" >').appendTo(document.body),b("#global-download-iframe").attr("src",c.url+"?"+c.data)))},a.request||(a.request=c),a}),e("base/lodashExt/util",["lodash","jquery"],function(a,b){"use strict";function c(b,c){var d={};if(d[b]=c,a[b])throw Error("mixin lodash !!"+b);a.mixin(d)}c("ensureArray",function(b){return null==b?[]:(a.isObject(b)&&!a.isArray(b)&&(b=[b]),b)}),c("mapArrayOrSingle",function(b,c){var d=a.isArray(b);d||(b=[b]);var e=a.map(b,c);return d?e:e[0]}),c("safeInvoke",function(a,b,c){if(a&&a[b]){var d=Array.prototype.slice.call(arguments,2);return a[b].apply(a,d)}return null}),c("decamelize",function(a,b){if("string"!=typeof a)throw new TypeError("Expected a string");return b="undefined"==typeof b?"_":b,a.replace(/([a-z\d])([A-Z])/g,"$1"+b+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+b+"$2").toLowerCase()}),c("normalizePath",function(a){return a.replace(/(\/+)/g,"/").replace("http:/","http://")});var d=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,e=/=[^,]+/gm,f=/=>.*$/gm;return c("getParameterNames",function(a){a||(a=this);var b=a.toString().replace(d,"").replace(f,"").replace(e,""),c=b.slice(b.indexOf("(")+1,b.indexOf(")")).match(/([^\s,]+)/g);return null===c?[]:c}),c("whenAjax",function(){var c=Array.prototype.slice.call(arguments),d=b.Deferred();return b.when.apply(b,c).done(function(){var b=a.toArray(arguments),c=a.map(b,function(b){return a.isArray(b)&&"success"===b[1]?b[0]:b});d.resolve.apply(d,c)}).fail(function(){d.reject(arguments)}),d.promise()}),c("doneDeferred",function(a){var c=b.Deferred();return c.resolve(a),c.promise()}),c("failDeferred",function(){var a=b.Deferred();return a.reject(),a.promise()}),a}),e("base/lodashExt/index",["lodash","./querystring","./request","./util"],function(a){"use strict";return a}),e("base/Observable",["lodash","./class"],function(a,b){"use strict";function c(a,b,c,e){for(var f,h,i=b.split(g);f=i.shift();){if(h=this[f],!h)throw new Error("Invalid method name: "+b);h.__isAspected||d.call(this,f),this.on(a+":"+f,c,e)}return this}function d(a){var b=this[a];this[a]=function(){var c=Array.prototype.slice.call(arguments),d=["before:"+a].concat(c),e=this.trigger.apply(this,d);if(e!==!1){var f=b.apply(this,arguments),g=["after:"+a,f].concat(c);return this.trigger.apply(this,g),f}},this[a].__isAspected=!0}function e(){this._defaultPrevented=!0}function f(){return this._defaultPrevented===!0}var g=/\s+/,h=b({initialize:function(){this._events={},this._listenId=a.uniqueId("l"),this._listeningTo={},this._delayEvents=[]},on:function(a,b,c,d,e){var f=this,g="string"==typeof a?[a]:a;d||(d=f),null==e&&(e="push");var h,i="function"==typeof b;if(void 0===b){for(var j in a)h=a[j],f.on(j,h);return this}for(var k=0,l=g.length;k<l;k++)if(a=g[k],h=i?b:b[a]){if(c){var m=h;h=function(){f.off(a,h),m.apply(d,arguments)},h.original=m}f._events[a]=f._events[a]||[];var n=f._events[a],o={context:d,callback:h};n[e](o)}return this},once:function(a,b,c){return this.on(a,b,!0,c)},onFirst:function(a,b,c,d){return this.on(a,b,c,d,"unshift")},listenTo:function(a,b,c,d){if(null==d&&(d=!1),"string"==typeof a)return this._delayEvents.push({name:a,event:b,callback:c}),this;var e=this._listenId,f=a._listenId,g=this._listeningTo;g[f]||(g[f]={obj:a,objId:f,id:e,count:0});var h=g[f];return a.on(b,c,d,this),h.count++,this},listenToOnce:function(a,b,c){return this.listenTo(a,b,c,!0)},off:function(a,b,c){var d=this,e=this._events,f=e[a];if(void 0===a)d._events={};else if(f)if(b||c)for(var g=f.length-1;g>=0;g--){var h=f[g];(b&&(b===h.callback||b===h.original)||c&&h.context===c)&&f.splice(g,1)}else d._events[a]=[];return d},stopListen:function(b,c,d){for(var e=this._listeningTo,f=b?[b._listenId]:a.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(c,d,this)}},trigger:function(a,b,c){if(!this._events)return this;var d=this._events[a],g=this;if(d){var h,i;null==b||null==c&&"object"==typeof b?(b=b||{},b.sender=g,b._defaultPrevented=!1,b.preventDefault=e,b.isDefaultPrevented=f,i=[b]):i=Array.prototype.slice.call(arguments,1),d=d.slice();for(var j=0,k=d.length;j<k;j++){var l=d[j],m=l.context||g,n=l.callback.apply(m,i);void 0!==n&&(h=n)}return h}},before:function(a,b,d){return c.call(this,"before",a,b,d)},after:function(a,b,d){return c.call(this,"after",a,b,d)},_initProps:function(){},_call:function(a,b){a.apply(this,Array.prototype.slice.call(b))}});return h}),e("base/logger",[],function(){"use strict";function a(a){return this.name=a||c,this._log=b,this._warn=b,this._error=b,this._info=b,this}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var b=function(){},c="veronica",d=window.console||{},e=function(){return(!Function.prototype.bind||Function.prototype.bind&&"undefined"==typeof window.addEventListener)&&"object"==typeof d&&"object"==typeof d.log},f={constructor:a,setName:function(a){return a||(a=c),this.name=a,this},enable:function(){if(this._log=d.log||b,this._info=d.info||this._info,this._warn=d.warn||this._log,this._error=d.error||this._log,Function.prototype.bind&&"object"==typeof d)for(var a=["log","warn","error"],c=0;c<a.length;c++)d[a[c]]=Function.prototype.call.bind(d[a[c]],d);return this},_write:function(a,b){var c=Array.prototype.slice.call(b);c.unshift(this.name+":"),e()?a(c.join(" ")):a.apply(d,c)},log:function(){this._write(this._log,arguments)},warn:function(){this._write(this._warn,arguments)},error:function(){this._write(this._error,arguments)},info:function(){this._write(this._info,arguments)},time:function(a,b){b||(b=""),d["time"+b](a)}};return a.prototype=f,a}),e("base/observable",["lodash","./class"],function(a,b){"use strict";function c(a,b,c,e){for(var f,h,i=b.split(g);f=i.shift();){if(h=this[f],!h)throw new Error("Invalid method name: "+b);h.__isAspected||d.call(this,f),this.on(a+":"+f,c,e)}return this}function d(a){var b=this[a];this[a]=function(){var c=Array.prototype.slice.call(arguments),d=["before:"+a].concat(c),e=this.trigger.apply(this,d);if(e!==!1){var f=b.apply(this,arguments),g=["after:"+a,f].concat(c);return this.trigger.apply(this,g),f}},this[a].__isAspected=!0}function e(){this._defaultPrevented=!0}function f(){return this._defaultPrevented===!0}var g=/\s+/,h=b({initialize:function(){this._events={},this._listenId=a.uniqueId("l"),this._listeningTo={},this._delayEvents=[]},on:function(a,b,c,d,e){var f=this,g="string"==typeof a?[a]:a;d||(d=f),null==e&&(e="push");var h,i="function"==typeof b;if(void 0===b){for(var j in a)h=a[j],f.on(j,h);return this}for(var k=0,l=g.length;k<l;k++)if(a=g[k],h=i?b:b[a]){if(c){var m=h;h=function(){f.off(a,h),m.apply(d,arguments)},h.original=m}f._events[a]=f._events[a]||[];var n=f._events[a],o={context:d,callback:h};n[e](o)}return this},once:function(a,b,c){return this.on(a,b,!0,c)},onFirst:function(a,b,c,d){return this.on(a,b,c,d,"unshift")},listenTo:function(a,b,c,d){if(null==d&&(d=!1),"string"==typeof a)return this._delayEvents.push({name:a,event:b,callback:c}),this;var e=this._listenId,f=a._listenId,g=this._listeningTo;g[f]||(g[f]={obj:a,objId:f,id:e,count:0});var h=g[f];return a.on(b,c,d,this),h.count++,this},listenToOnce:function(a,b,c){return this.listenTo(a,b,c,!0)},off:function(a,b,c){var d=this,e=this._events,f=e[a];if(void 0===a)d._events={};else if(f)if(b||c)for(var g=f.length-1;g>=0;g--){var h=f[g];(b&&(b===h.callback||b===h.original)||c&&h.context===c)&&f.splice(g,1)}else d._events[a]=[];return d},stopListen:function(b,c,d){for(var e=this._listeningTo,f=b?[b._listenId]:a.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(c,d,this)}},trigger:function(a,b,c){if(!this._events)return this;var d=this._events[a],g=this;if(d){var h,i;null==b||null==c&&"object"==typeof b?(b=b||{},b.sender=g,b._defaultPrevented=!1,b.preventDefault=e,b.isDefaultPrevented=f,i=[b]):i=Array.prototype.slice.call(arguments,1),d=d.slice();for(var j=0,k=d.length;j<k;j++){var l=d[j],m=l.context||g,n=l.callback.apply(m,i);void 0!==n&&(h=n)}return h}},before:function(a,b,d){return c.call(this,"before",a,b,d)},after:function(a,b,d){return c.call(this,"after",a,b,d)},_initProps:function(){},_call:function(a,b){a.apply(this,Array.prototype.slice.call(b))}});return h}),e("base/history",["./observable","jquery"],function(a,b){"use strict";var c=/^[#\/]|\s+$/g,d=/^\/+|\/+$/g,e=/msie [\w.]+/,f=/\/$/,g=/#.*$/,h=a.extend({initialize:function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var d=this.root.replace(f,"");a.indexOf(d)||(a=a.slice(d.length))}else a=this.getHash();return a.replace(c,"")},start:function(a){if(h.started)throw new Error("Backbone.history has already been started");h.started=!0,this.options=_.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var f=this.getFragment(),g=document.documentMode,i=e.exec(navigator.userAgent.toLowerCase())&&(!g||g<=7);if(this.root=("/"+this.root+"/").replace(d,"/"),i&&this._wantsHashChange){var j=b('<iframe src="javascript:0" tabindex="-1">');this.iframe=j.hide().appendTo("body")[0].contentWindow,this.navigate(f)}this._hasPushState?b(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?b(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=f;var k=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&k.hash&&(this.fragment=this.getHash().replace(c,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){b(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),h.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b!==this.fragment&&(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),_.some(this.handlers,function(b){if(b.route.test(a))return b.callback(a),!0})},navigate:function(a,b){if(!h.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(g,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}});return h.started=!1,h}),e("base/index",["jquery","./lodashExt/index","./class","./Observable","./logger","./history"],function(a,b,c,d,e,f){"use strict";var g={_:b,$:a,createClass:c,Observable:d,Logger:e,History:f,history:new f};return g}),e("framework/appPart",["../base/index"],function(a){var b=(a._,a.$),c=a.Observable,d=c.extend({initialize:function(a){a||(a={}),this.supr(a),this.options=b.extend(!0,{},this.options,a),this._app=a.app},app:function(){return this._app||this},logger:function(){return this.get("part:app:logger")},loader:function(){return this.get("part:app:loader").get()}});return d}),e("framework/appProvider",["../base/index","./appPart"],function(a,b){var c=a._,d=c.extend,e=b.extend({initialize:function(a){this.supr(a),this._pool={},this._defaultKey="default",this._nested=!1},_preprocess:function(a){return a},setDefault:function(a){this._defaultKey=a},get:function(a){a||(a=this._defaultKey);var b=this._nested?c.get(this._pool,a):this._pool[a];return b},add:function a(b,e,f){var g=this;if(c.isObject(b))f=e,c.each(b,function(b,c){a.call(g,c,b,f)});else{f=d({force:!1,inherit:"default"},f);var h=this.get(b);if(!h||f.force===!0){if("string"!=typeof e){var i=this.get(f.inherit);c.isFunction(e)||(e=d({},i,e))}e.__id=b,e=g._preprocess(e),this._pool[b]=e}}},has:function(a){return"undefined"!=typeof this._pool[a]},remove:function(a){this._pool[a]=null,delete this._pool[a]}});return e}),e("framework/router",["../base/index","./appPart"],function(a,b){"use strict";var c=a._,d=/\((.*?)\)/g,e=/(\(\?)?:\w+/g,f=/\*\w+/g,g=/[\-{}\[\]+?.,\\\^$|#\s]/g,h=b.extend({initialize:function(b){b||(b={}),this.supr(b),b.routes&&(this.routes=b.routes),this.history=b.history||a.history,this._bindRoutes()},route:function(a,b,d){var e=this;c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(b)&&(d=b,b=""),d||(d=this[b]);var f=this;return this.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(d,g),f.trigger.apply(f,["route:"+b].concat(g)),f.trigger("route",b,g),e.history.trigger("route",f,b,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,b){return this.history.navigate(a,b),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(g,"\\$&").replace(d,"(?:$1)?").replace(e,function(a,b){return b?a:"([^/?]+)"}).replace(f,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});return h}),e("framework/appRouter",["../base/index","./router"],function(a,b){var c=a._,d=(c.throttle,b.extend({options:{homePage:"home"},initialize:function(a){a||(a={}),this.supr(a),this._preParams=void 0},routes:{"(/)":"entry","(/)?*params":"entry","page=*page":"openPage","(/)*page":"openPage","(/)*page?*params":"openPage","widget/:widget@:context":"executeWidget"},entry:function(a){this._openPage(this.options.homePage,a)},_openPage:function(a,b){var d=this.app(),e=this,f=this._preParams===b;if(this._preParams=b,d.part("page").isCurrent(a)){if(f)return;d.pub("qs-changed",c.qs(b).toJSON())}e._changePage(a,b)},_changePage:c.throttle(function(a,b){var c=this.app();c.part("page").change(a,b)},500),execute:function(a,b){var c=this.app();c.part("component").start({initializer:a,options:{_context:b||"default",el:".v-widget-root"}})},openPage:function(a,b){this._openPage(a,b)}}));return d}),e("framework/layoutManager",["../base/index","./appProvider"],function(b,c){"use strict";var d="scaffold",e=b._,f=c.extend({options:{rootNode:".v-layout-root"},initialize:function(a){this.supr(a)},_preprocess:function(a){return e.isString(a)&&(a={html:a}),a},_getLayoutRoot:function(){var b=a(this.options.rootNode);return 0===b.length&&(b=a("body")),b},change:function(b){var c=this,d=this.app(),f=e.doneDeferred(),g=c._getLayoutRoot(),h=this.get(b);return h?(d.pub("layoutChanging",{name:b,root:g}),h.url&&(f=a.get(h.url).done(function(a){h.html=a})),f.done(function(){g.html(h.html),d.pub("layoutChanged",{name:b})}),f):(this.logger().warn("Could not find the layout configuration! layout name: "+b),e.doneDeferred())},init:function(){var b=this.get(d);b.html&&a("body").prepend(b.html)}});return f}),e("framework/pageManager",["../base/index","./appProvider"],function(a,b){var c=(a.$,a._),d=c.each,e=c.flatten,f=c.doneDeferred,g=c.failDeferred,h=b.extend({options:{autoResolvePage:!1},initialize:function(a){this.supr(a),this._currPageName=""},_build:function(a){var b=this;if(b.options.autoResolvePage){var c={name:a,components:[a]};return b.add(a,c),c}return null},_getComponentConfigsRecursive:function a(b,c,e){return null==c&&(c=this),null==e&&(e=[]),e.push(b.components),d(b.inherits,function(b){var d=c.get(b);e=a(d,c,e)}),e},_getAllComponentConfigs:function(a){return e(this._getComponentConfigsRecursive(a))},isCurrent:function(a){var b=this.getCurrName();return"default"===b||b===a},getCurrName:function(){return this._currPageName},_setCurrName:function(a){this._currPageName=a},_changeLayout:function(a){var b=this.app(),c=b.part("layout"),d=this.getCurrName(),e=this.get(d);return""===d||e&&e.layout!==a?c.change(a):f()},_load:function(a,b){var c=this.app(),d=c.part("component");return d.start(a,b).done(function(){d.recycle()})},resolve:function(a){var b=this.get(a),c=this;return b||(b=c._build(a)),b&&(b.components=c._getAllComponentConfigs(b)),b?f(b):g()},change:function(a,b){var c=this,d=this.app();c.resolve(a).done(function(b){c._changeLayout(b.layout).done(function(){d.pub("pageLoading",a),c._load(b.components,a).then(function(){c._setCurrName(a),d.pub("pageLoaded",a)})})}).fail(function(){d.pub("pageNotFound",a)})},active:function(a){return a?this.change(a):a=this.getCurrName()}});return h}),e("component/meta",["../base/index"],function(a){var b=(a.$,a._),c=/^(.*)\:(.*)/,d=/^(.*?)\:(.*)/;return{methods:{get:function(a){var b=d.exec(a),c=b[1],e=b[2];if("vm"===c)return this.model(e);if("ui"===c)return this.ui(e);if("dom"===c)return this.$(e);if("cmp"===c){var f=this._findChild(e);return this._getComponent(f.id)}return"part"===c?this._getPart(e):void 0},listen:function(a,d){var e=c.exec(a),f=e[1],g=e[2];if("bus"===f)return d=evt,this.sub(g,d);var e=eventPattern.exec(g),h=(e[1],e[2]);if(""===f||null==f)return this.listenTo(g,d);var i=f+":"+h,j=b.bind(function(a,b,c){var d=this._partType(a);return d.listen(this,b,c)},this,f,g,d);this._addPartListen(i,j);var k=this._getPart(i);return null!=k?j():void 0},create:function(a,c){var e=this,f=d.exec(a),g=f[1],h=f[2];if("cmp"===g)return this.startChildren(c);if("provider"===g)return this.createProvider(h,c);if("part"===g)return this.createPart(h,c);var i;if(b.isFunction(c))i=c.call(this);else{var j=this._partType(g);null!=j&&(i=j.create(this,h,c))}i.then&&b.isFunction(i.then)?i.then(function(b){e._addPart(a,b)}):this._addPart(a,i)},_getComponent:function(a){return this.get("part:app:component").get(a)},_getContext:function(){return this.options._source},_getBatchName:function(){return this.options._batchName},_componentManager:function(){return this.get("part:app:component")},_mediator:function(){return this.get("part:app:mediator")},_i18n:function(a){var b=this.get("part:app:i18n").get();return b[a]},_uiKit:function(){return this.get("part:app:uiKit")},opt:function(a){return b.get(this.options,a)},log:function(a,c){var d=this.logger();c||(c="log"),d.setName(this._type+"("+this._name+")"),b.isArray(a)?d[c].apply(d,a):d[c](a),d.setName()}}}}),e("component/communication",["../base/index"],function(a){function b(a){this._stop=!1,this._result=[],Object.assign(this,{flow:"down",data:null,sender:null},a)}var c=a.$,d=a._,e=c.Deferred,f=/^(\S+)\s*(.*)$/,g=/^(\S+)\s*(.*)$/;return b.prototype={stop:function(){this._stop=!1},isStop:function(){return this._stop}},{props:{_messages:[],_delayEvents:[]},configs:{events:{}},methods:{_getEvents:function(a){var b=d.result(this,"events");return b[a]},_listenEventBus:function(){var a=this._getEvents("bus"),b=this;d.each(a,function(a,c){b.sub(c,a)})},_listenComponent:function(){var a=this,b=this._getEvents("cmp");d.each(b,function(b,c){a.listenTo(c,b)})},_delegateDOMEvents:function(a){if(a||(a=this._getEvents("dom")),!a)return this;this._undelegateDOMEvents();for(var b in a){var c=a[b];if(d.isFunction(c)||(c=this[a[b]]),c){var e=b.match(g),f=e[1],h=e[2];c=d.bind(c,this),f+=".delegateEvents"+this._id,""===h?this.$el.on(f,c):this.$el.on(f,h,c)}}return this},_undelegateDOMEvents:function(){return this.$el.off(".delegateEvents"+this._id),this},_listenToParent:function(a,b){var c=this.app(),d=this;if(null!=this._parent){var e=c.part("component").get(this._parent);d.listenTo(e,a,b)}},_listenToChild:function(a,b,c){this._delayEvents.push({name:a,event:b,callback:c}),this._findChild(a)&&this.listenTo(this._findChild(a),b,c)},_listenToDelay:function(a,b){var c=this,e=d.filter(c._delayEvents,function(b){return b.name===a});d.each(e,function(a){c.listenTo(b,a.event,a.callback)})},listenTo:function(a,b,c){var e=this;if(d.isString(a)){if(null==c){c=b;var g=f.exec(a);a=g[1],b=g[2]}return"parent"===a?void e._listenToParent(b,c):"this"===a?void e.listenTo(this,b,c):void e._listenToChild(a,b,c)}if(!d.isString(b)){var h=a;return c=b,void d.each(h,function(a){e.listenTo(a[0],a[1],c)})}this.supr.call(this,a,b,c)},_attachObserver:function(a,b,c){var d=this._mediator(),e=this,f=function(a){return b.call(e,a)};this._messages=this._messages||[],this._messages.push({name:a,listener:b,callback:f}),d[c](a,f)},_pub:function(a,e,f){var g=this._mediator(),h=[],i=new b({sender:this,data:e});this.log(["emitted",a,i]),h.push(g.trigger(a,i)),c.when.apply(null,h).then(function(){var a=d.flatten(arguments);f.resolve(a)},function(a){f.reject(a)})},sub:function(a,b){this._attachObserver(a,b,"on")},subOnce:function(a,b){this._attachObserver(a,b,"once")},pub:function(a,b){var c=this,f=this.app(),g=e(),h=d.bind(function(a,b,c){this._pub(a,b,c)},c,a,b,g);return f.busy()?f.addTask(h):h(),g.promise()},unsub:function(){var a=this._mediator(),b=this._messages;this._messages&&d.each(b,function(b){a.off(b.name,b.callback)})},unsubOne:function(a,b){var c=this.get("part:app:mediator");this._messages&&(this._messages=d.reject(this._events,function(d){var e=d.name===a&&d.listener===b;return e&&c.off(a,d.callback),e}))}}}}),e("component/parentChild",["../base/index"],function(a){var b=a.$,c=a._,d="data-ver-role",e={switchable:[],components:null},f={active:function(a){var b=this;this._activeViewName=c.isUndefined(a)?this._activeViewName:a;var d=this.view(this._activeViewName);c.each(this.switchable,function(a){b.view(a)&&b.view(a).hide()}),d.show(),this.trigger("activeView",this._activeViewName),d.trigger("active")},_descendant:function(a){var b=this;null==a&&(a=[]);var d=this._children;if(null==d||0===d.length)return a;var e=c.map(d,function(a){return a.id});return a=a.concat(e),c.each(e,function(c){var d=b._componentManager().get(c);a=d._descendant(a)}),a},children:function(a){return null==a&&(a=!1),a?this._descendant():this._children},parent:function(){return this._parent},parents:function(){for(var a=this._parent,b=this._componentManager(),c=[];null!=a;){c.push(a);var d=b.get(a);a=d._parent}return c},_addChild:function(a){var b=this;a._parent=b._id,b._children.push({id:a._id,name:a.options._name}),b.trigger("addChild",a)},removeChild:function(a){c.remove(this._children,function(b){return b.name===a})},_findChild:function(a){return c.find(this._children,function(b){return b.name===a})},startChildren:function(a,b){var d=this,e=this._componentManager();return null==a&&(a=c.result(this,"components")),a=c.map(a,function(a){c.isString(a)&&(a={name:a,options:{}});a.options||{};return a}),e.start(a,b).done(function(){var a=c.toArray(arguments);c.each(a,function(a){d._addChild(a)}),d.options.activeView&&d.active(d.options.activeView)})},stopChildren:function(){var a=this._children,b=this._componentManager();c.each(a,function(a){b.stop(a.id)})},parse:function(){var a=[],c=this;return this.$el.find("["+d+"]").each(function(c,d){var e=b(d),f=e.data();
f.options||(f.options={}),f.options.el=e,a.push({name:f.name,xtype:f.verRole,options:f.options})}),c.startChildren(a)},_stopChild:function(a){var b=this._componentManager(),c=this,d=c._findChild(a);c.removeChild(a),b.stop(d.id)}};return{props:{_children:[],_parent:null},configs:e,methods:f}}),e("component/mvvm",["../base/index"],function(a){var b=a.$,c=a._,d=b.noop,e={_bindDOM:!1},f={viewEngine:"",defaultModel:function(){return{}},bound:d},g={_viewEngine:function(){return this.get("part:app:viewEngine").get(this.viewEngine)},model:function(a,d){if(!c.isUndefined(a)){if(c.isString(a)&&this._viewModel)return null!=d&&this._setModelValue(a,d,this._viewModel),this._getModelValue(a);var e=a;e.toJSON?this._viewModel=e:this._viewModel=this._createViewModel(b.extend({},e)),this.trigger("modelCreated",{data:this._viewModel})}return this._viewModel},toJSON:function(a){return this._modelToJSON(this.model(a))},_createViewModel:function(a){return this._viewEngine().create(a,this)},_bindViewModel:function(){var a=this,c=a.model();if(null!=c){var d=this.$(".data-bind-block").not(this.$(".ver-component .data-bind-block"));0===d.length&&(d=this.$el),d.each(function(d,e){a._viewEngine().bind(a,b(e),c)}),this._bindDOM=!0,this.trigger("bound",{data:c}),this.log(this.cid+" bound")}},_getModelValue:function(a,b){return b||(b=this.model()),this._viewEngine().get(b,a)},_setModelValue:function(a,b,c){return c||(c=this.model()),this._viewEngine().set(c,a,b)},_modelToJSON:function(a){return this._viewEngine().toJSON(a)},_destoryModel:function(){this._viewEngine().unbind(this),this._viewModel=null}};return{props:e,configs:f,methods:g}}),e("component/dom",["../base/index"],function(a){var b=a.$,c=a._,d=b.noop,e="ver-component",f="__componentRef__",g={_templateIsLoading:!1,_compiledTpl:null,$mountNode:null,_outerEl:b({})},h={template:null,templateUrl:null,templateEngine:"lodash",rendered:d},i={ui:function(a){var b=this.$('[data-ref="'+a+'"]');return this._uiKit().getInstance(b)},$:function(a){var c=this.$el.find(a);return this._outerEl.each(function(d,e){var f,g=b(e).is(a);f=g?b(e):b(e).find(a),0!==f.length&&b.merge(c,f)}),c},_removeElement:function(){return this._undelegateDOMEvents(),this.options.replace?this.$el.replaceWith(this.$mountNode):this.$el.remove(),this},_setElement:function(a,c){return this.$el&&this._removeElement(),this.$el=a instanceof b?a:b(a),0===this.$el.length&&(this.$el=b("<div></div>")),this.$el.length>1&&(this.$el=b("<div></div>").append(this.$el)),this.el=this.$el[0],this.$el.addClass(e).data(f,this._id),c!==!1&&this._delegateDOMEvents(),this},_mountElement:function(a){this.$mountNode||(a||(a=this.options.el),this.$mountNode=b(a));var d=this.get("part:app:component");if(d.isCurrBatch(this._getBatchName()))if(this.options.replace){var e=this,f=this.$mountNode.prop("attributes");c.each(f,function(a){return"class"===a.name?void e.$el.addClass(a.value):void e.$el.attr(a.name,a.value)}),this.$mountNode.replaceWith(this.$el)}else this.$mountNode.append(this.$el)},_templateEngine:function(){return this.get("part:app:templateEngine").get(this.templateEngine)},render:function(a){a?this._compile(a):this._compiledTpl||this._compile();var b=this._renderTemplate(this._compiledTpl);return this._setElement(b,!0),this._mountElement(),this.trigger("rendered"),this},_compile:function(a){var b=this;return this._fetchTemplate(a).then(function(a){b._compiledTpl=c.isFunction(a)?a:b._compileTemplate(a),b.trigger("compiled")})},_compileTemplate:function(a){return this._templateEngine().compile(a,this)},_executeTemplate:function(a){var b=this._templateEngine().options(this);return a(b)},_renderTemplate:function(a){var b=c.isFunction(a)?a:this._compileTemplate(a);return this._executeTemplate(b)},_fetchTemplate:function(a){var d=this,e=b.Deferred();if(null==a)if(this.templateUrl){var f=this._invoke("templateUrl");this._templateIsLoading=!0,b.get(f).always(function(){d._templateIsLoading=!1}).then(function(a){c.isString(a)?e.resolve(a):e.reject()},function(){e.reject()})}else a=this.template,this.options.el&&!a&&(a=this.template=c.unescape(this.$el.html())),e.resolve(a);else e.resolve(a);return e.promise()},show:function(){var a=this;this.$el.show(!1,function(){a.options.autoResize&&a.resize()})},hide:function(){this.$el.hide(!1)}};return{props:g,configs:h,methods:i}}),e("component/part",["../base/index","../framework/appProvider"],function(a,b){var c=(a.$,a._),d=/^(.*?)\:(.*)/,e=a.$.extend;return{props:{_parts:{},_delayListens:{}},methods:{_partType:function(a){return 0==a&&(a="default"),this.get("part:app:partType").get(a)},_getPart:function(a){var b=d.exec(a);if(null!=b){var c=b[1],e=b[2];if("app"==c)return this.app().get("part:"+e)}return this._parts[a]},_addPart:function(a,b){var c=this._parts[a];null==c&&(this._parts[a]=b,this.trigger("addPart",a,b))},_addPartListen:function(a,b){var c=this._delayListens[a];null==c&&(this._delayListens[a]=[]),this._delayListens[a].push(b)},_callPartListen:function(a){var b=c.find(this._delayListens,function(b,c){return c===a});null!=b&&c.each(b,function(a){a()})},part:function(a){return this._getPart(a)},createPart:function(a,b){var c=b.ctor;b=b.options;var d=this;b=e({app:d},d.options[a],b);var f=new c(b);return null!=a&&d._addPart(a,f),f},createProvider:function(a,c){return c||(c={}),null==c.ctor&&(c.ctor=b),"object"==typeof c.ctor&&(c.ctor=b.extend(c.ctor)),this.createPart(a,c)}}}}),e("component/_combine",["./meta","./communication","./parentChild","./mvvm","./dom","./part"],function(){var a=Array.prototype.slice.call(arguments);return a}),e("component/index",["../base/index","./_combine","../framework/appPart"],function(a,b,c){var d=a._,e=a.$,f=d.extend,g=e.noop,h=c.extend({options:{el:null,replace:!0,autoRender:!0,autoChildren:!0},initialize:function(a){a||(a={}),this.supr(a),this._invoke("_setup"),this.trigger("created"),this._observeModel(),this.options.autoRender&&this.render()},created:g,destroyed:g,_initProps:function(){this._id=d.uniqueId("component$"),d.extend(this,d.pick(this.options,["_name","_componentName","_context"]))},_observeModel:function(){this.model(this._invoke("defaultModel"))},_listen:function(){this.listenTo(this,"addChild",function(a){this._listenToDelay(a.options._name,a)}),this.listenTo(this,"addPart",function(a,b){this._callPartListen(a)}),this.listenTo(this,"modelCreated",function(){this._viewEngine().bindEvents(this._viewModel,this),this._bindDOM!==!0&&null==this.$el||this._bindViewModel()}),this.listenTo(this,"beforeCreate",function(){this._invoke("beforeCreate")}),this.listenTo(this,"created",function(){this._listenEventBus(),this._listenComponent(),this._invoke("created")}),this.listenTo(this,"rendered",function(){var a=this;this.options.autoChildren?e.when(this.parse(),this.startChildren()).then(function(){a._bindViewModel()}):a._bindViewModel(),a.trigger("ready")}),this.listenTo(this,"ready",function(){this._invoke("ready")})},_setup:function(){this._invoke("_initProps"),this._invoke("_listen")},_destroy:function(){this.stopChildren(),this.unsub(),this.stopListening(),this._removeElement(),this._destoryModel(),this._invoke("destroyed")},stop:function(){this.get("part:app:component").stop(this)},_invoke:function(a,b){var c=this.app(),f=d.toArray(arguments),g=f.length>=2?2:1;null==b&&(b=!0),b&&(f=f.concat([c,d,e]));var h=a;return d.isString(a)&&(h=this[a]),d.isFunction(h)?h.apply(this,f.slice(g)):h},destroy:function(){this._destroy(),this.log("destroyed")},reset:function(a){this.destroy(),a=e.extend({},this.options,a),this.initialize(a)}});return d.each(b,function(a){h.members(a,{merge:["_listen"]})}),h.define=function(a,b){var c;if(null==b&&(b=!0),"object"==typeof a){var d=f(!0,{},h.base,a);c=h.extend(d),c.export=d}else{if(!a.extend)return a;c=a}return b?function(a){return new c(a)}:c},h.create=function(a,b){a||(a={});var c={_xtypeName:a._xtypeName,_xtypeContext:a._xtypeContext,_exclusive:!1};b=d.extend(c,b);for(var e=h.define(a),f=e;null!=f&&"function"==typeof f;)f=f(b);return null==f&&console.error("Component should return an object. [errorName:"+b._name),f},h}),e("framework/componentManager",["../base/index","../component/index","./appProvider"],function(b,c,e){"use strict";var f="ver-component",g="__componentRef__",h=b._,i=h.ensureArray,j=h.uniqBy,k=h.each,l=h.map,m=(h.extend,e.extend({options:{defaultMountNode:".v-component-root"},initialize:function(a){this.supr(a),this._currBatchName=null,this._currBatchConfigList=[],this._lastBatchConfigList=[]},register:function(a,b){var c=this.app();return c.part("componentDef").add(a,b)},_normalizeConfig:function(a){var b=this;h.isString(a)&&(a={name:a,options:{}});var c=/([\w|-]*)\(?([\w\-@]*)\)?(?:=>)?(.*)/,d=a.name?c.exec(a.name):[];return a.name=d[1],a.xtype=a.xtype||d[2],null==a.options&&(a.options={}),a.options.el=a.options.el||d[3]||b.options.defaultMountNode,a.options._name=a.name,a},_normalizeBatchConfig:function(a,b){var c=this;return a=h.map(a,function(a){var d=c._normalizeConfig(a,b);return d.options._batchName=b,d}),j(a,function(a){return a.options.el})},isCurrBatch:function(a){var b=this.app(),c=b.part("page");return!a||!c||c.isCurrent(a)},start:function(b,d){var e=[],f=this,g=this.app(),h=a.Deferred(),j=g.part("componentDef");return g.busy(!0),b=f._normalizeBatchConfig(i(b),d),f._updateCurrConfigList(b,d),k(b,function(a){if("empty"===a.xtype)return void f.stopByDom(a.options.el);if(null!=a.xtype&&f._allowStart(a)){var b=j.resolve(a.xtype,a.options);null!=b&&e.push(b)}}),a.when.apply(a,e).done(function(){var a=arguments;1===e.length&&(a=[arguments]);var b=l(a,function(a){var b=a[0],d=a[1];if(f.isCurrBatch(d._batchName)){f.stopByDom(d.el),d.app=g;var e=c.create(b,d);return e&&f.add(e._id,e),e}return null});g.busy(!1),g.pub("componentsLoaded"),h.resolve.apply(h,b)}),h.promise()},_updateCurrConfigList:function(a,b){var c=this;b?(c._lastBatchConfigList=c._currBatchConfigList,c._currBatchName=b,c._currBatchConfigList=a):c._currBatchConfigList=c._currBatchConfigList.concat(a)},_allowStart:function(a){var b=this,c=a.name,d=a.options||{},e=d.el,f=!!h.find(b._lastBatchConfigList,function(b){var d=b.name===c,f=b.xtype===a.xtype,g=b.options.el===e;return d&&f&&g});return!f},getByDom:function(b){var c=a(b).data(g);return this.get(c)},findDom:function(b){return a(b).find("."+f)},stop:function(a){var b=this,c=(this.app(),h.isString(a)?b.get(a):a);if(null!=c){var d=b.get(c._parent);d&&d.removeChild(c._name),b.remove(c._id),c.destroy()}},stopAll:function(){h.each(this._runningPool,function(a){a.destroy()}),this._runningPool=[]},stopByDom:function(b){var c=this,d=c.getByDom(b);d&&c.stop(d),c.findDom(b).each(function(b,d){c.stopByDom(a(d))})},recycle:function(){var a=this;h.each(this._runningPool,function(b){b&&b.$el&&0===b.$el.closest(document.body).length&&a.stop(b)})},_unload:function(a){var b;if(d.s){var c=d.s.contexts._.defined;for(b in c)c.hasOwnProperty(b)&&b.indexOf(a)!==-1&&d.undef(b)}}}));return m}),e("framework/componentDefManager",["../base/index","./appProvider"],function(a,b){var c=a._,e=a.$,f=b.extend({options:{defaultContext:null,autoParseContext:!1},_getLoadPackage:function(a,b){var d=this.app(),e=d.part("env").isDebug(),f=d.options.releaseComponentPath+"/"+a;if(e){var g=d.part("module").get(b);f=g.resolveLocation(a)}return f=c.normalizePath(f),{name:a,location:f,main:"main"}},_parseContext:function(a){return this.options.autoParseContext?a.split("-")[0]:null},_parseName:function(a){var b=this,c=/([\w|-]+)@?([\w|-]*)/,d=c.exec(a),e=d[1],f=d[2]||b._parseContext(e)||b.options.defaultContext;return{name:e,context:f}},resolve:function(a,b){var f,g=this,h=e.Deferred();if(c.isString(a)){var i=g._parseName(a);if(b&&(b._xtypeName=i.name,b._xtypeContext=i.context),g.has(i.name))f=g.get(i.name),h.resolve(f,b);else{var j=this.loader();j.require([i.name],!0,{packages:[g._getLoadPackage(i.name,i.context)]}).done(function(a,d){var e=d;c.isArray(e)&&(e=d[0]),h.resolve(e,b)}).fail(function(a){if("timeout"===a.requireType)console&&console.warn&&console.warn("Could not load module "+a.requireModules);else{var b=a.requireModules&&a.requireModules[0];d.undef(b),console&&console.error&&console.error(a)}h.reject()})}}else h.resolve(a,b);return h.promise()}});return f}),e("framework/index",["./appPart","./appProvider","./appRouter","./layoutManager","./pageManager","./componentManager","./componentDefManager"],function(a,b,c,d,e,f,g){"use strict";var h={AppPart:a,AppProvider:b,AppRouter:c,LayoutManager:d,PageManager:e,ComponentManager:f,ComponentDefManager:g};return h}),e("application/appInjection",["../base/index","../framework/index"],function(a,b){var c=a._;return function(d){d.create("part:mediator",{ctor:a.Observable}),d.create("part:logger",{ctor:a.Logger}),d.create("part:componentDef",{ctor:b.ComponentDefManager}),d.create("part:component",{ctor:b.ComponentManager}),d.create("part:layout",{ctor:b.LayoutManager}),d.create("part:page",{ctor:b.PageManager}),d.create("part:router",{ctor:b.AppRouter}),d.create("provider:partType"),d.create("provider:uiKit"),d.create("provider:templateEngine"),d.create("provider:viewEngine"),d.create("provider:module"),d.create("provider:i18n"),d.create("provider:loader"),d._addPart("history",a.history);var e=/^(\S+)\s*(.*)$/;d.part("partType").add("default",{create:function(a){},listen:function(a,b,c){}}),d.part("partType").add("ui",{create:function(){},listen:function(a,b,d){var f=e.exec(b),g=f[1],h=f[2];h=a.ui("[data-ref="+h+"]"),null!=h&&h.bind(g,c.bind(d,a))}}),d.part("uiKit").add("default",{init:function(a,b){},create:function(a,b){},addParts:function(a){},destroy:function(){},getInstance:function(a){}}),d.part("viewEngine").add("default",{bind:function(a,b,c){},unbind:function(a){},create:function(a){return a},bindEvents:function(a,b){},get:function(a,b){},set:function(a,b,c){},toJSON:function(a){return a}});var f=d.get("part:templateEngine");f.add("default",{options:function(a){return{}},compile:function(a){return function(){return a}}}),f.add("underscore",{options:function(a){return c.extend({},a.options)},compile:function(a,b){return c.template(a,{variable:"data"})}}),f.add("lodash",{options:function(a){return c.extend({},a.options)},compile:function(a,b){return c.template(a,{variable:"data"})}});var g=d.get("part:module");g.add("default",{name:"default",path:"widgets",multilevel:!1,locationPattern:/(\w*)-?(\w*)-?(\w*)-?(\w*)-?(\w*)/,resolvePath:function(){var a=this.path;return a.replace("${name}",this.name)},resolveLocation:function(a){var b=this,d=a;if(b.multilevel===!0){var e=b.locationPattern.exec(a);d=c.reduce(e,function(a,c,d){return""===c?a:1===d?c===b.name?"":c:a+"/"+c})}return b.resolvePath()+"/"+d}})}}),e("application/index",["../base/index","../framework/index","../component/index","./appInjection"],function(b,c,d,e){"use strict";var f=d.extend({options:{name:"app",global:!0},initialize:function(a){a||(a={}),this.supr(a)},_setup:function(){this.supr(),this.supr(),this._busy=!1,this._taskQueue=[],this.name=this.options.name,e(this)},created:function(){this._subscribe()},_subscribe:function(){var a=this;a.sub("layoutChanging",function(b,c){a.part("component").stop(c)})},busy:function(a){if(null!=a){var b=this._busy;this._busy=a,b!==a&&a===!1&&this._runTask()}return this._busy},_runTask:function(){for(var a=this._taskQueue;a.length>0;)a.shift()()},addTask:function(a){this._taskQueue.push(a)},start:function(){this.history.start({pushState:!1}),this.pub("appStarted")},stop:function(){this.part("component").stopAll()},use:function(b){var c=this;return _.isArray(b)||(b=[b]),a.each(b,function(a,b){b(c,f)}),this}},!1);return f}),e("veronica",["./base/index","./framework/index","./component/index","./application/index"],function(a,b,c,d){"use strict";var e=a._.extend,f={};return e(f,a),e(f,b),f.Component=c,f.Application=d,f.createApp=function(a){window.__verApp&&window.__verApp.stop();var b=new d(a);return b.core=f,b.options.global&&(window.__verApp=b),b},f}),e("jquery",function(){return a}),e("lodash",function(){return _}),d("veronica")});
//# sourceMappingURL=veronica.min.js.map