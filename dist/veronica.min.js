!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore"],b):a.veronica=b(a.$,a._)}(this,function(a,b){var c,d,e;return function(a){function b(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||c,"undefined"===v||"function"===v){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[c],u):void 0,c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},c=d=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},c._defined=q,e=function(a,c,d){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},e.amd={jQuery:!0}}(),e("../bower_components/almond/almond",function(){}),!function(a){function b(){this._events={},this._conf&&c.call(this,this._conf)}function c(a){a&&(this._conf=a,a.delimiter&&(this.delimiter=a.delimiter),a.maxListeners&&(this._events.maxListeners=a.maxListeners),a.wildcard&&(this.wildcard=a.wildcard),a.newListener&&(this.newListener=a.newListener),this.wildcard&&(this.listenerTree={}))}function d(a){this._events={},this.newListener=!1,c.call(this,a)}function f(a,b,c,d){if(!c)return[];var e,g,h,i,j,k,l,m=[],n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if("function"==typeof c._listeners)return a&&a.push(c._listeners),[c];for(e=0,g=c._listeners.length;g>e;e++)a&&a.push(c._listeners[e]);return[c]}if("*"===o||"**"===o||c[o]){if("*"===o){for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&(m=m.concat(f(a,b,c[h],d+1)));return m}if("**"===o){l=d+1===n||d+2===n&&"*"===p,l&&c._listeners&&(m=m.concat(f(a,b,c,n)));for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&("*"===h||"**"===h?(c[h]._listeners&&!l&&(m=m.concat(f(a,b,c[h],n))),m=m.concat(f(a,b,c[h],d))):m=h===p?m.concat(f(a,b,c[h],d+2)):m.concat(f(a,b,c[h],d)));return m}m=m.concat(f(a,b,c[o],d+1))}if(i=c["*"],i&&f(a,b,i,d+1),j=c["**"])if(n>d){j._listeners&&f(a,b,j,n);for(h in j)"_listeners"!==h&&j.hasOwnProperty(h)&&(h===p?f(a,b,j[h],d+2):h===o?f(a,b,j[h],d+1):(k={},k[h]=j[h],f(a,b,{"**":k},d+1)))}else j._listeners?f(a,b,j,n):j["*"]&&j["*"]._listeners&&f(a,b,j["*"],n);return m}function g(a,b){a="string"==typeof a?a.split(this.delimiter):a.slice();for(var c=0,d=a.length;d>c+1;c++)if("**"===a[c]&&"**"===a[c+1])return;for(var e=this.listenerTree,f=a.shift();f;){if(e[f]||(e[f]={}),e=e[f],0===a.length){if(e._listeners){if("function"==typeof e._listeners)e._listeners=[e._listeners,b];else if(h(e._listeners)&&(e._listeners.push(b),!e._listeners.warned)){var g=i;"undefined"!=typeof this._events.maxListeners&&(g=this._events.maxListeners),g>0&&e._listeners.length>g&&(e._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",e._listeners.length),console.trace())}}else e._listeners=b;return!0}f=a.shift()}return!0}var h=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},i=10;d.prototype.delimiter=".",d.prototype.setMaxListeners=function(a){this._events||b.call(this),this._events.maxListeners=a,this._conf||(this._conf={}),this._conf.maxListeners=a},d.prototype.event="",d.prototype.once=function(a,b){return this.many(a,1,b),this},d.prototype.many=function(a,b,c){function d(){0===--b&&e.off(a,d),c.apply(this,arguments)}var e=this;if("function"!=typeof c)throw new Error("many only accepts instances of Function");return d._origin=c,this.on(a,d),e},d.prototype.emit=function(){this._events||b.call(this);var a=arguments[0];if("newListener"===a&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var c=arguments.length,d=new Array(c-1),e=1;c>e;e++)d[e-1]=arguments[e];for(e=0,c=this._all.length;c>e;e++)this.event=a,this._all[e].apply(this,d)}if("error"===a&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var g;if(this.wildcard){g=[];var h="string"==typeof a?a.split(this.delimiter):a.slice();f.call(this,g,h,this.listenerTree,0)}else g=this._events[a];if("function"==typeof g){if(this.event=a,1===arguments.length)g.call(this);else if(arguments.length>1)switch(arguments.length){case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:for(var c=arguments.length,d=new Array(c-1),e=1;c>e;e++)d[e-1]=arguments[e];g.apply(this,d)}return!0}if(g){for(var c=arguments.length,d=new Array(c-1),e=1;c>e;e++)d[e-1]=arguments[e];for(var i=g.slice(),e=0,c=i.length;c>e;e++)this.event=a,i[e].apply(this,d);return i.length>0||!!this._all}return!!this._all},d.prototype.on=function(a,c){if("function"==typeof a)return this.onAny(a),this;if("function"!=typeof c)throw new Error("on only accepts instances of Function");if(this._events||b.call(this),this.emit("newListener",a,c),this.wildcard)return g.call(this,a,c),this;if(this._events[a]){if("function"==typeof this._events[a])this._events[a]=[this._events[a],c];else if(h(this._events[a])&&(this._events[a].push(c),!this._events[a].warned)){var d=i;"undefined"!=typeof this._events.maxListeners&&(d=this._events.maxListeners),d>0&&this._events[a].length>d&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}}else this._events[a]=c;return this},d.prototype.onAny=function(a){if("function"!=typeof a)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(a),this},d.prototype.addListener=d.prototype.on,d.prototype.off=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");var c,d=[];if(this.wildcard){var e="string"==typeof a?a.split(this.delimiter):a.slice();d=f.call(this,null,e,this.listenerTree,0)}else{if(!this._events[a])return this;c=this._events[a],d.push({_listeners:c})}for(var g=0;g<d.length;g++){var i=d[g];if(c=i._listeners,h(c)){for(var j=-1,k=0,l=c.length;l>k;k++)if(c[k]===b||c[k].listener&&c[k].listener===b||c[k]._origin&&c[k]._origin===b){j=k;break}if(0>j)continue;return this.wildcard?i._listeners.splice(j,1):this._events[a].splice(j,1),0===c.length&&(this.wildcard?delete i._listeners:delete this._events[a]),this}(c===b||c.listener&&c.listener===b||c._origin&&c._origin===b)&&(this.wildcard?delete i._listeners:delete this._events[a])}return this},d.prototype.offAny=function(a){var b,c=0,d=0;if(a&&this._all&&this._all.length>0){for(b=this._all,c=0,d=b.length;d>c;c++)if(a===b[c])return b.splice(c,1),this}else this._all=[];return this},d.prototype.removeListener=d.prototype.off,d.prototype.removeAllListeners=function(a){if(0===arguments.length)return!this._events||b.call(this),this;if(this.wildcard)for(var c="string"==typeof a?a.split(this.delimiter):a.slice(),d=f.call(this,null,c,this.listenerTree,0),e=0;e<d.length;e++){var g=d[e];g._listeners=null}else{if(!this._events[a])return this;this._events[a]=null}return this},d.prototype.listeners=function(a){if(this.wildcard){var c=[],d="string"==typeof a?a.split(this.delimiter):a.slice();return f.call(this,c,d,this.listenerTree,0),c}return this._events||b.call(this),this._events[a]||(this._events[a]=[]),h(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},d.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof e&&e.amd?e("eventemitter",[],function(){return d}):"object"==typeof exports?exports.EventEmitter2=d:window.EventEmitter2=d}(),e("core/events",["underscore"],function(a){"use strict";var b={},c=[],d=(c.push,c.slice),e=(c.splice,b.Events={on:function(a,b,c){if(!g(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(b,c,d){if(!g(this,"once",b,[c,d])||!c)return this;var e=this,f=a.once(function(){e.off(b,f),c.apply(this,arguments)});return f._callback=c,this.on(b,f,d)},off:function(b,c,d){var e,f,h,i,j,k,l,m;if(!this._events||!g(this,"off",b,[c,d]))return this;if(!b&&!c&&!d)return this._events=void 0,this;for(i=b?[b]:a.keys(this._events),j=0,k=i.length;k>j;j++)if(b=i[j],h=this._events[b]){if(this._events[b]=e=[],c||d)for(l=0,m=h.length;m>l;l++)f=h[l],(c&&c!==f.callback&&c!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[b]}return this},trigger:function(a){if(!this._events)return this;var b=d.call(arguments,1);if(!g(this,"trigger",a,b))return this;var c=this._events[a],e=this._events.all;return c&&h(c,b),e&&h(e,arguments),this},stopListening:function(b,c,d){var e=this._listeningTo;if(!e)return this;var f=!c&&!d;d||"object"!=typeof c||(d=this),b&&((e={})[b._listenId]=b);for(var g in e)b=e[g],b.off(c,d,this),(f||a.isEmpty(b._events))&&delete this._listeningTo[g];return this}}),f=/\s+/,g=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(f.test(c)){for(var g=c.split(f),h=0,i=g.length;i>h;h++)a[b].apply(a,[g[h]].concat(d));return!1}return!0},h=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},i={listenTo:"on",listenToOnce:"once"};return a.each(i,function(b,c){e[c]=function(c,d,e){var f=this._listeningTo||(this._listeningTo={}),g=c._listenId||(c._listenId=a.uniqueId("l"));return f[g]=c,e||"object"!=typeof d||(e=this),c[b](d,e,this),this}}),e.bind=e.on,e.unbind=e.off,a.extend(b,e),e}),e("core/extend",[],function(a,b){"use strict";var c=function(a,b){var c,d=this;c=a&&_.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},_.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&_.extend(c.prototype,a),c.__super__=d.prototype,c};return c}),e("core/view",["jquery","underscore","./events","./extend"],function(a,b,c,d){"use strict";var e={$:a},f=e.View=function(a){this.cid=b.uniqueId("view"),a||(a={}),b.extend(this,b.pick(a,h)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},g=/^(\S+)\s*(.*)$/,h=["model","collection","el","id","attributes","className","tagName","events"];return b.extend(f.prototype,c,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof e.$?a:e.$(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=b.result(this,"events")))return this;this.undelegateEvents();for(var c in a){var d=a[c];if(b.isFunction(d)||(d=this[a[c]]),d){var e=c.match(g),f=e[1],h=e[2];d=b.bind(d,this),f+=".delegateEvents"+this.cid,""===h?this.$el.on(f,d):this.$el.on(f,h,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(b.result(this,"el"),!1);else{var a=b.extend({},b.result(this,"attributes"));this.id&&(a.id=b.result(this,"id")),this.className&&(a["class"]=b.result(this,"className"));var c=e.$("<"+b.result(this,"tagName")+">").attr(a);this.setElement(c,!1)}}}),f.extend=d,f}),e("core/history",["./events","./extend","jquery"],function(a,b,c){"use strict";var d={$:c},e=d.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},f=/^[#\/]|\s+$/g,g=/^\/+|\/+$/g,h=/msie [\w.]+/,i=/\/$/,j=/#.*$/;return e.started=!1,_.extend(e.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(i,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(f,"")},start:function(a){if(e.started)throw new Error("Backbone.history has already been started");e.started=!0,this.options=_.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var b=this.getFragment(),c=document.documentMode,i=h.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c);if(this.root=("/"+this.root+"/").replace(g,"/"),i&&this._wantsHashChange){var j=d.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=j.hide().appendTo("body")[0].contentWindow,this.navigate(b)}this._hasPushState?d.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?d.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var k=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&k.hash&&(this.fragment=this.getHash().replace(f,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){d.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),e.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),_.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!e.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(j,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),d.history=new e,d.history}),e("core/router",["underscore","./events","./extend","./history"],function(a,b,c,d){"use strict";var e={history:d},f=e.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},g=/\((.*?)\)/g,h=/(\(\?)?:\w+/g,i=/\*\w+/g,j=/[\-{}\[\]+?.,\\\^$|#\s]/g;return a.extend(f.prototype,b,{initialize:function(){},route:function(b,c,d){a.isRegExp(b)||(b=this._routeToRegExp(b)),a.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var f=this;return e.history.route(b,function(a){var g=f._extractParameters(b,a);f.execute(d,g),f.trigger.apply(f,["route:"+c].concat(g)),f.trigger("route",c,g),e.history.trigger("route",f,c,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,b){return e.history.navigate(a,b),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var b,c=a.keys(this.routes);null!=(b=c.pop());)this.route(b,this.routes[b])}},_routeToRegExp:function(a){return a=a.replace(j,"\\$&").replace(g,"(?:$1)?").replace(h,function(a,b){return b?a:"([^/?]+)"}).replace(i,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(b,c){var d=b.exec(c).slice(1);return a.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}}),f.extend=c,f}),e("core/loader",["jquery"],function(a){"use strict";var b={};return b.useGlobalRequire=function(){return window.require?window.require:d},b.useGlobalRequirejs=function(){return window.requirejs?window.requirejs:c},b.require=function(c,d,e){var f=a.Deferred(),g=b.useGlobalRequire();return null==d&&(d=!0),d?(a.isArray(c)||(c=[c]),e&&g.config(e),g(c,function(){var a;a=1===arguments.length?arguments[0]:Array.prototype.slice.call(arguments),f.resolve(c,a)},function(a){console.error(a),f.reject(a)})):f.resolve(c,null),f.promise()},b}),e("util/logger",[],function(){"use strict";function a(a){return this.name=a||c,this._log=b,this._warn=b,this._error=b,this._info=b,this.time=b,this}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var b=function(){},c="veronica",d=window.console||{},e=function(){return(!Function.prototype.bind||Function.prototype.bind&&"undefined"==typeof window.addEventListener)&&"object"==typeof d&&"object"==typeof d.log},f={constructor:a,setName:function(a){return a||(a=c),this.name=a,this},enable:function(){if(this._log=d.log||b,this._info=d.info||this._info,this._warn=d.warn||this._log,this._error=d.error||this._log,this.time=this._time,Function.prototype.bind&&"object"==typeof d)for(var a=["log","warn","error"],c=0;c<a.length;c++)d[a[c]]=Function.prototype.call.bind(d[a[c]],d);return this},write:function(a,b){var c=Array.prototype.slice.call(b);c.unshift(this.name+":"),e()?a(c.join(" ")):a.apply(d,c)},log:function(){this.write(this._log,arguments)},warn:function(){this.write(this._warn,arguments)},error:function(){this.write(this._error,arguments)},info:function(){this.write(this._info,arguments)},_time:function(a,b){b||(b=""),d["time"+b](a)}};return a.prototype=f,a}),e("util/util",["underscore","jquery"],function(a,b){"use strict";function c(a,b){var c,d;for(d in b)c=b[d],a[d]=c;return a}function d(a,b){return c(a.prototype,b)}function e(a,b){a.prototype?d(a,b):c(a,b)}function f(a,b){b=b.replace(/\[(\w+)\]/g,".$1"),b=b.replace(/^\./,"");for(var c=b.split(".");c.length;){var d=c.shift();if(!(d in a))return;a=a[d]}return a}function g(a,b,c){b=b.replace(/\[(\w+)\]/g,".$1"),b=b.replace(/^\./,"");for(var d=b.split("."),e="o",f=a;d.length;){var g=d.shift();if(!(g in f||0===d.length))return;e+='["'+g+'"]',f=f[g]}e+="=v;",new Function("o, v",e)(a,c)}return a.mixin({indexOf2:function(b,c){var d=a.indexOf;if(!a.isFunction(c))return d(b,c);for(var e=0;e<b.length;e++)if(c(b[e]))return e;return-1},safeInvoke:function(a,b,c){var d=Array.slice.call(arguments,2);a&&a[b].apply(a,d)}}),{decamelize:function(a,b){return b=void 0===b?"_":b,a.replace(/([A-Z])/g,b+"$1").toLowerCase()},camelize:function(a){return a.replace(/(?:^|[-_])(\w)/g,function(a,b){return b?b.toUpperCase():""})},extend:c,include:d,mixin:e,getter:f,setter:g,qsToJSON:function(a){a||(a=location.search.slice(1));var b=a.split("&"),c={};return b.forEach(function(a){a=a.split("="),c[a[0]]=decodeURIComponent(a[1]||"")}),JSON.parse(JSON.stringify(c))},donePromise:function(a){var c=b.Deferred();return c.resolve(a),c.promise()},failPromise:function(){var a=b.Deferred();return a.reject(),a.promise()},normalizePath:function(a){return a.replace("//","/")},splitNameParts:function(c){var d=b.isArray(c);d||(c=[c]);var e=a.map(c,function(a){var b=a.split("@");return{name:b[0],source:b[1]}});return d?e:e[0]}}}),e("util/aspect",["underscore","jquery","exports"],function(a,b,c){"use strict";function d(a,b,c,d){for(var h,i,j=b.split(g);h=j.shift();)i=e(this,h),i.__isAspected||f.call(this,h),this.on(a+":"+h,c,d);return this}function e(a,b){var c=a[b];if(!c)throw new Error("Invalid method name: "+b);return c}function f(a){var b=this[a];this[a]=function(){var c=Array.prototype.slice.call(arguments),d=["before:"+a].concat(c);if(this.trigger.apply(this,d)!==!1){var e=b.apply(this,arguments),f=["after:"+a,e].concat(c);return this.trigger.apply(this,f),e}},this[a].__isAspected=!0}c.before=function(a,b,c){return d.call(this,"before",a,b,c)},c.after=function(a,b,c){return d.call(this,"after",a,b,c)};var g=/\s+/;a.mixin({aopBefore:function(a,b){return function(){var c=arguments,d=b.call(this,c);return d===!1?!1:d&&d.done?d.done(function(){a.apply(this,c)}).fail(function(){return!1}):a.apply(this,c)}},aopAfter:function(a,b){return function(){var c=a.apply(this,arguments);return c===!1?!1:c&&c.done?c.done(function(){b.apply(this,arguments)}).fail(function(){return!1}):b.apply(this,arguments)}}})}),e("core/core",["jquery","underscore","eventemitter","./events","./view","./history","./router","./loader","../util/logger","../util/util","../util/aspect"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l={$:a,_:b,ext:{},helper:{},View:e,Router:g,history:f,Events:d,i18n:{defaultDialogTitle:"对话框",windowCloseText:"关闭",loadingText:"加载中..."},constant:{DEFAULT_MODULE_NAME:"__default__",SCAFFOLD_LAYOUT_NAME:"scaffold",WIDGET_TYPE:"widget",WIDGET_CLASS:"ver-widget",WIDGET_TAG:"ver-tag",SANDBOX_REF_NAME:"__sandboxRef__"},enums:{}},m={WIDGET:"widget",APP:"app"};l.enums.hostType=m,l.loader=h,l.util=j,l.aspect=k,l.getConfig=function(){var a=l.loader.useGlobalRequirejs(),b=a.s?a.s.contexts._.config:{sources:{}};return b.sources||(b.sources={}),function(){return b}}(),l.logger=new i,l.getConfig().debug&&l.logger.enable();var n=b.defaults(l.getConfig()||{},{wildcard:!0,delimiter:".",newListener:!0,maxListeners:50});return l.createMediator=function(){return new c(n)},l.mediator=new c(n),l}),e("core/application",["./core"],function(b){"use strict";function c(a){var c=b.$,d={name:"app",extensions:[],modules:[],autoBuildPage:!1,features:["dialog","plugin","spa"],autoParseWidgetName:!1,releaseWidgetPath:"./widgets",widgetNamePattern:/(\w*)-?(\w*)-?(\w*)/g,global:!1,plugins:{},defaultPage:"default",homePage:"home",page:{defaultLayout:"default",defaultHost:".v-render-body",defaultSource:"basic",defaultInherit:"_common"},module:{defaults:{multilevel:!1,hasEntry:!0,entryPath:"main",widgetPath:"widgets",source:"modules"},defaultModule:{name:b.constant.DEFAULT_MODULE_NAME,source:".",path:".",hasEntry:!1,build:"{{ dir }}{{ baseUrl }}{{ type }}"}},router:{pagePattern:"/?(.+)??(.+)"}};a=c.extend(!0,{},d,a||{}),a.modules&&0!==a.modules.length||(a.modules=[a.module.defaultModule]);var e={_extensions:[],name:a.name,core:b,lang:{},config:a};c.extend(this,e)}var d={constructors:c,launch:function(c){var d=[],e=this;return c||(c={}),_(this.config.extensions).each(function(a){var c=b.loader.require(a,_.isString(a)).done(function(a,b){_.isFunction(b)&&e.use(b)});d.push(c)}),_(this.config.modules).each(function(a){var b=e.module.create(a),c=b.loadEntry();e.module.add(b),d.push(c)}),a.when.apply(a,d).done(function(){e.module.apply(),e.widget["package"](),c.parse&&e.parser.parse()})},stop:function(){this.sandbox.stop()},use:function(b){var d=this;return _.isArray(b)||(b=[b]),a.each(b,function(a,b){b(d,c)}),this},mixin:function(a,b){return null==b&&(b=!0),b?this.core.util.mixin(this,a):this.core.util.mixin(c,a),this},emit:function(){var a=Array.prototype.slice.call(arguments);a.push(this.name),this.sandbox.emit.apply(this.sandbox,a)}};return c.prototype=d,c}),e("app/emitQueue",[],function(){"use strict";return function(a){a.core._,a.core.$;a.emitQueue={_emitQueue:[],empty:function(){for(var a=this._emitQueue;a.length>0;)a.shift()()},push:function(a){this._emitQueue.push(a)}}}}),e("app/page",[],function(){return function(a){function b(a){return a.widgets&&0!==a.widgets.length&&e.each(a.widgets,function(b,c){if(e.isString(b)){var d=b.split("@");a.widgets[c]={name:d[0],options:{host:d[1]||f.page.defaultHost,_source:d[2]||f.page.defaultSource}}}}),a}var c=a.core,d=a.core.$,e=a.core._,f=a.config,g={_pages:{_common:{widgets:[]},currPageName:""},_changeTitle:function(){},_processInherit:function(a){var b=this,c=e(a.inherit).map(function(a){return b.get(a).widgets});return c.unshift(a.widgets),e.uniq(e.union.apply(e,c),!1,function(a){return a.options&&a.options.el?a.options.el:a.name+a.options.host})},isCurrent:function(a){return"default"===this._pages.currPageName||this._pages.currPageName===a},getCurrentName:function(){return this.get("currPageName")},_load:function(b,f,g){var h=this,i=this._processInherit(f);if(g){var j=a.core.util.qsToJSON(g);j&&e.each(i,function(a){a.options=d.extend(a.options,j)})}var k,l=this.getCurrentName(),m=d.Deferred(),n=c.util.donePromise();return a.emit("pageLoading",b),(""===l||(k=this.get(l))&&k.layout!==f.layout)&&(n=a.layout.change(f.layout).done(function(){a.emit("layoutChanged",f.layout)}).fail(function(){m.reject()})),n.done(function(){h._pages.currPageName=b,a.sandbox.startWidgets(i,b).done(function(){a.widget.recycle(),a.emit("pageLoaded",b),m.resolve()})}),m.promise()},active:function(a){return a?this.change(a):a=this.get("currPageName")},defaultConfig:function(b){var c=a.page.parseName(b);return{widgets:[c.fullname+"@"+a.config.page.defaultHost+"@"+c.module]}},parseName:function(a){var b,c=a.indexOf("/")>-1?"/":"-",d=a.split(c);switch(d.length){case 1:b={module:"basic",controller:"Home",action:d[0]};break;case 2:b={module:"basic",controller:d[0],action:d[1]};break;case 3:b={module:d[0],controller:d[1],action:d[2]}}return b.fullname=b.module+"-"+b.controller+"-"+b.action,b},get:function(a){var b=this._pages[a];return b},add:function(a){var c=this;return e.isArray(a)||(a=[a]),e.each(a,function(a){e(a).each(function(c,e){c=b(c),a[e]=d.extend({name:"",layout:f.page.defaultLayout,widgets:[{name:e,options:{_host:f.page.defaultHost,_source:f.page.defaultSource}}],inherit:[f.page.defaultInherit]},c)}),d.extend(c._pages,a)}),this},start:function(b){b&&a.layout.init(),a.router.start(),a.emit("appStarted")},change:function(b,e){var f=this,g=f.get(b),h=c.util.donePromise(g);if(!g&&a.config.autoBuildPage){var i={};i[b]=f.defaultConfig(b),f.add(i),g=f.get(b)}if(!g){var j=b.replace("-","/");h=d.getJSON(j)}h.done(function(a){f._load(b,a,e)}).fail(function(){a.emit("pageNotFound",b)})}};a.page=g}}),e("app/layout",[],function(){"use strict";return function(a){var b=a.core._,c=a.core.$,d="v-render-body",e=a.core.constant,f={_layouts:{},add:function(a){var d=this;return c.each(a,function(a,c){b.isString(c)&&(c={html:c}),d._layouts[a]=c}),this},change:function(e){var f=a.core.util.donePromise(),g=c("."+d);0===g.length&&(g=c("body")),b.each(g.find(".ver-widget"),function(b){a.widget.stop(c(b))});var h=this.get(e);return h?(a.emit("layoutChanging",e),h.url&&(f=c.get(h.url).done(function(a){h.html=a})),f.done(function(){g.html(h.html)}),f):(a.core.logger.warn("Could not find the layout configuration! layout name: "+e),a.core.util.failPromise())},get:function(a){return this._layouts[a]},init:function(){var a=this.get(e.SCAFFOLD_LAYOUT_NAME);a.html&&c("body").prepend(a.html)}};f._layouts[e.SCAFFOLD_LAYOUT_NAME]={html:'<div class="'+d+'"></div>'},a.layout=f}}),e("app/module",[],function(){"use strict";return function(a){var b=a.core,c=a.core._,d=function(){function d(b,d){c.isString(b)&&(b={name:b,source:a.config.module.defaults.source}),c.defaults(b,a.config.module.defaults);var e=a.core.getConfig().sources[b.source]||b.source,f={name:b.name,config:b,path:b.path||e+"/"+b.name,execution:d};c.extend(this,f)}var e={constructor:d,addSource:function(b){var d=this;null==b&&(b={},b[this.name]=this.config.widgetPath),c.each(b,function(b,c){a.core.getConfig().sources[c]=d.path+"/"+b})},addPlugin:function(b){a.plugin.add(b,this.name)},addControl:function(b){var d=a.core.getConfig().controls;d||(d=[]),c.isArray(b)||(b=[b]),a.core.getConfig().controls=c.uniq(d.concat(b))},addPage:function(b){a.page.add(b)},addExtension:function(b){a.use(b)},addLayout:function(b){a.layout.add(b)},loadEntry:function(){var a=this,c=this.path+"/"+this.config.entryPath;return b.loader.require(c,this.config.hasEntry).done(function(b,c){a.execution=c})},apply:function(){this.addSource(),this.execution&&this.execution(this,a)}};return d.prototype=e,d}(),e={_modules:{},apply:function(){c.each(this.get(),function(a){a.apply()})},create:function(a,b){return new d(a,b)},add:function(a){this._modules[a.name]=a},get:function(a){return null==a?this._modules:this._modules[a]},path:function(a){return this._modules[a].path}};a.module=e}}),e("app/navigation",[],function(){"use strict";return function(a){function b(d){c.each(d,function(e,f){if(e.items&&(b(e.items),e.items=c.compact(e.items)),e.url){var g=a.page.get(e.url);g?(e.name||(e.name=g.name),!e.code&&g.code&&(e.code=g.code)):d[f]=!1}})}var c=a.core._;a.navigation={_nav:null,create:function(a){b(a),this._nav=c.compact(a)},get:function(){return this._nav}}}}),e("app/plugin",[],function(){"use strict";return function(a){var b=a.core._;a.plugin={_plugins:{},_pluginCache:{},getConfig:function(b){var c=a.config.plugins[b];return null==c?[]:c},resolvePath:function(c){var d=this._plugins[c],e=a.core.getConfig();return b.isUndefined(d)?[]:b.map(d,function(b){var c,d=b.name;"pl-"+b.module+"-";return c=e.debug===!0?a.module.path(b.module)+"/plugins/":"./plugins/",{name:b.name,location:c+d}})},add:function(a,c){var d=this._plugins;b.each(a,function(a){b.isString(a)&&(a={name:"pl-"+c+"-"+a,target:a});var e=a.name,f=a.target;b.isUndefined(d[f])&&(d[f]=[]),
d[f].push({name:e,module:c})})},cache:function(c,d){var e=this._pluginCache[c]={};b.each(d,function(c){var d=c(a);b.each(d,function(a,c){b.isUndefined(e[c])&&(e[c]=[]),e[c].push(a)})})},execute:function(a,c){var d=c._name;if(a===d&&(d="main"),this._pluginCache[a]){var e=this._pluginCache[a][d];b.each(e,function(a){a.call(c)})}}}}}),e("core/sandbox",["./core"],function(a){"use strict";function b(a){this.name=a.name,this.app=a.app,this.type="sandbox",this._id=a._id,this._hostType=a._hostType,this._children=[],this._events=[]}var c=a._,d=(a.$,function(b){return function(d,e,f,g){var h=a.mediator;if(!c.isFunction(e)||!c.isString(d))throw new Error("Invalid arguments passed to sandbox."+b);f=f||this;var i=function(){var a=Array.prototype.slice.call(arguments);e.apply(f,a)};this._events=this._events||[],this._events.push({name:d,listener:e,callback:i,tag:g}),h[b](d,i)}}),e={constructor:b,log:function(b,d){if(d||(d="log"),a.logger.setName(this._hostType+"("+this.name+")"),c.isArray(b)){var e=[];e.push(b.shift()),e.push(b.shift()),e.push(b),a.logger[d].apply(a.logger,e)}else a.logger[d](b);a.logger.setName()},getConfig:a.getConfig,on:d("on"),once:d("once"),off:function(b,d){var e=a.mediator;this._events&&(this._events=c.reject(this._events,function(a){var c=a.name===b&&a.listener===d;return c&&e.off(b,a.callback),c}))},emit:function(){var b=a.mediator,d=a.app,e=Array.prototype.slice.call(arguments),f=c.bind(function(){b.emit.apply(b,e),e.unshift("emitted"),this.log(e)},this);d.widget.isLoading?d.emitQueue.push(f):f()},stopListening:function(b){var d=a.mediator,e=this._events;this._events&&(b&&(e=c(e).filter(function(a){return a.tag===b})),c(e).each(function(a){d.off(a.name,a.callback)}))},startWidgets:function(b,d,e){var f=a.app;return f.widget.start(b,c.bind(function(a){var b=a.sandbox;b._parent=this._id,this._children.push({ref:b._id,caller:e})},this),d)},stop:function(){var b=a.app;b.widget.stop(this)},stopChildren:function(b){var d=this._children,e=a.app;b&&(d=c(d).filter(function(a){return a.caller===b})),c.invoke(c.map(d,function(a){return e.sandboxes.get(a.ref)}),"stop")},getHost:function(){}};return b.prototype=e,b}),e("app/sandboxes",["../core/sandbox"],function(a){"use strict";return function(b){var c=b.core,d=c._,e={_sandboxPool:{}};e.create=function(b,e){var f=d.uniqueId("sandbox$");e||(e=c.enums.hostType.WIDGET);var g=new a({name:b,_id:f,_hostType:e,app:c.app}),h=this._sandboxPool;if(h[f])throw new Error("Sandbox with ref "+f+" already exists.");return h[f]=g,g},e.remove=function(a){this._sandboxPool[a]=null,delete this._sandboxPool[a]},e.get=function(a){return this._sandboxPool[a]},e.getByName=function(a){return d(this._sandboxPool).filter(function(b){return b.name===a})},b.sandboxes=e}}),e("core/widget",[],function(){"use strict";var a=function(a,b,c){var d,e,f=c.core,g=f.$,h=(b._page,b._name),i=c.sandboxes.create(h),j={_name:null,_page:null,_sandboxRef:i._id,_exclusive:!1,sandbox:i};return b=g.extend(j,b),a=c.view._createExecutor(a),_.isFunction(a)&&(d=a(b)),_.isUndefined(d)?console.warn("Widget should return an object. [errorWidget:"+h):(e=_.isFunction(d)?d(b):d,e._name=b._name,e.sandbox=i,e.options||(e.options=b),e.$el&&e.$el.addClass(i.name).addClass(f.constant.WIDGET_CLASS).data(f.constant.WIDGET_CLASS,i.name).data(f.constant.WIDGET_TAG,b._tag).data(f.constant.SANDBOX_REF_NAME,i._id),i.getHost=function(){return c.widget._widgetsPool[i._id]}),e};return a}),e("app/widget",["../core/widget"],function(a){"use strict";return function(b){function c(a){return!!b.widget._localWidgetExes[a]}function d(a){return b.widget._localWidgetExes[a]}var e=b.core,f=b.core._,g=b.core.$,h=b.config.module.defaultWidgetPath,i=e.constant.SANDBOX_REF_NAME,j=e.constant.WIDGET_CLASS,k=e.loader.useGlobalRequire(),l={_localWidgetExes:{},_widgetsPool:{},_currWidgetList:[],_oldWidgetList:[],isLoading:!1};l["package"]=function(a){var c={packages:[]};a||(a=e.getConfig().controls),f.isString(a)&&(a=[a]),f(a).each(function(a){var d=b.core.util.splitNameParts(a),e=l.resolvePath(d);c.packages.push(e)}),k.config(c)},l.register=function(a,c){b.widget._localWidgetExes[a]=c},l.resolvePath=function(a){var c=g.isArray(a);c||(a=[a]);var d=f.map(a,function(a){var c=a.name,d=a.source,g=h,i=e.getConfig(),j=c,k=d||e.constant.DEFAULT_MODULE_NAME,l=i.debug===!1,m=b.config.widgetNamePattern.exec(j);k===e.constant.DEFAULT_MODULE_NAME&&b.config.autoParseWidgetName===!0&&(k=m[1]);var n=b.module.get(k);return l?g=b.config.releaseWidgetPath:(n&&n.config.multilevel&&(j=f.reduce(m,function(a,b,c){return 1===c?e.util.camelize(b):""===b?a:e.util.camelize(a)+"/"+e.util.camelize(b)})),g=i.sources&&i.sources[k]||g),{name:c,location:e.util.normalizePath(g+"/"+j),main:"main"}});return c?d:d[0]},l.load=function(a,h,i){var j=g.Deferred(),l=[],m=b.core.util.splitNameParts(a);m.source=h._source||m.source;var n=m.name,o=[m];b.plugin&&(l=b.core.util.splitNameParts(b.plugin.getConfig(m.name)),o=o.concat(l));var p=b.widget.resolvePath(o);if(h._name=n,h._page=i,c(n)){var q=d(n);j.resolve(q,h)}else e.loader.require(f.map(o,function(a){return a.name}),!0,{packages:p}).done(function(a,b){var c,d=b;f.isArray(d)&&(d=b[0],c=b.slice(1)),j.resolve(d,h,c)}).fail(function(a){if("timeout"===a.requireType)console&&console.warn&&console.warn("Could not load module "+a.requireModules);else{var b=a.requireModules&&a.requireModules[0];k.undef(b),console&&console.error&&console.error(a)}j.reject()});return j.promise()},l.start=function(a,c,d){var h=[];return f.isObject(a)&&!f.isArray(a)&&(a=[a]),b.widget.isLoading=!0,l._cacheList(a,d),f.each(a,function(a){var c=a.options||{},e=c.host,f=a.name;if("empty"===f&&l.clear(e,c._exclusive),l._allowLoad(a)){var g=b.widget.load(f,c,d);h.push(g)}}),g.when.apply(g,h).done(function(){var a=arguments;1===h.length&&(a=[arguments]),f.each(a,function(a){var d=a[0],f=a[1],g=a[2],h=f._page;if(g&&b.plugin.cache(f._name,g),!h||!b.page||b.page.isCurrent(h)){var i=l.create(d,f);l.clear(f.host,f._exclusive),i&&(l.add(i),c&&c(i),e.mediator.emit("widgetLoaded."+i._name))}}),b.widget.isLoading=!1,e.mediator.emit("widgetsLoaded"),b.emitQueue.empty()})},l.clear=function(a,c){if(a){var d=f(b.widget._currWidgetList).filter(function(b){return b.options.host===a}),e=g(a).children("."+j);f.each(e,function(a){var e=g(a),h=f(d).some(function(a){var b=e.hasClass(a.name),c=a.options._tag===e.data("verTag");return b&&c});if(!h||c){var j=e.data(i);j&&b.widget.stop(b.sandboxes.get(j))}})}},l._cacheList=function(a,b){b?(l._oldWidgetList=l._currWidgetList,l._currWidgetList=a):l._currWidgetList=l._currWidgetList.concat(a)},l._allowLoad=function(a){var c=a.options||{},d=c.host,e=a.name,h=0===g(d).find("."+e).length,i=f.find(b.widget._oldWidgetList,function(b){var c=b.name===a.name,d=b.options._tag===a.options._tag,e=b.options.host===a.options.host,f=b.options.el===a.options.el;return c&&d&&e&&f});return"empty"!==e&&(h||!i)},l.add=function(a){l._widgetsPool[a.options.sandbox._id]=a},l.create=function(c,d){return a(c,d,b)},l.get=function(a){return l._widgetsPool[a]},l.remove=function(a){b.widget._widgetsPool[a]=null,delete b.widget._widgetsPool[a]},l.stop=function(a){if(f.isString(a)){var c=a;f(b.sandboxes.getByName(c)).each(function(a){b.widget.stop(a)})}else{var d;if(a.type&&"sandbox"===a.type){d=a;var e;if(!d)return;if(d.getHost&&(e=d.getHost(),e&&e.loadingTemplate))return;var h=b.sandboxes.get(d._parent);return h&&h._children.splice(f(h._children).indexOf2(function(a){return a.ref===d._id}),1),b.sandboxes.remove(d._id),d.stopChildren(),d.stopListening(),void(e&&(e.destroy&&e.destroy(),e.remove?e.remove():e.$el.remove(),e.options&&(e.options.sandbox=null),e.sandbox=null,b.widget.remove(d._id)))}var k=a,l=g(k).data(i),m=g(k).find("."+j);m.length>0&&f.each(m,function(a){b.widget.stop(g(a))}),l&&(d=b.sandboxes.get(l),b.widget.stop(d))}},l.recycle=function(){f(b.sandboxes._sandboxPool).each(function(a){if(a.getHost){var c=a.getHost();c&&c.$el&&0===c.$el.closest(document.body).length&&b.widget.stop(a)}})},l._unload=function(a){var b;if(k.s){var c=k.s.contexts._.defined;for(b in c)c.hasOwnProperty(b)&&-1!==b.indexOf(a)&&k.undef(b)}},b.widget=l}}),e("app/parser",[],function(){"use strict";return function(a){var b=(a.core._,a.core.$),c="data-ver-role";a.parser={},a.parser.parse=function(d,e){d||(d="body");var f=[];b(d).find("["+c+"]").each(function(a,c){var d=b(c),e=d.data();e.options||(e.options={}),e.options.el=d,f.push({name:e.verRole,options:e.options})}),a.sandbox.startWidgets(f)},a.parser.parseView=function(a,d){b(a.$el).find("["+c+"]").each(function(c,e){var f=b(e),g=f.data();g.options||(g.options={}),g.options.el=f,a.view(g.verRole,{name:g.verRole,initializer:d[g.verRole],options:g.options})})}}}),e("app/view/view-mvvm",[],function(){return function(a){var b=a.core.$,c=a.core._;b.noop;a.view.base._createViewModel=function(a){return a},a.view.base.model=function(a,d){if(!c.isUndefined(a)){if(c.isString(a)&&this.viewModel)return this.viewModel.get(a);a.toJSON?this.viewModel=a:this.viewModel=this._createViewModel(b.extend({},this.baseModel,a)),this.delegateModelEvents(this.viewModel),d!==!1&&this._bindViewModel()}return this.viewModel},a.view.base.shareModel=function(a){c.isUndefined(a)&&(a=this.options.sharedModel);var b=this.options.sharedModelProp;if(a){if(b){var d={};return c.each(b,function(b){c.isString(b)?d[b]=a.get(b):d[b[0]]=a.get(b[1])}),d}return a}return{}},a.view.base._bindViewModel=function(){var a=this.options.sandbox;(this.options.bindEmptyModel||!b.isEmptyObject(this.viewModel))&&(this._bind(),this.$el.hasClass("k-bind-block")||this.$el.addClass("k-bind-block"),this.trigger("modelBound",this.viewModel),a.log(this.cid+" modelBound"))}}}),e("app/view/view-view",[],function(){return function(a){var b=a.core.$,c=a.core._;b.noop;a.view.base._createSubviews=function(a){var b=this;if(a||(a=this.views),a){var a=c.result(this,"views");c.each(a,function(a,d){c.isString(a)||b.view(d,a)}),this.options.activeView&&this.active(this.options.activeView)}},a.view.base._createSubview=function(b,d){return c.isFunction(b)&&(b=b.apply(this)),b.cid?(b._name=d,b):(b.options=b.options||{},c.isString(b.options.host)&&(b.options.host=this.$(b.options.host)),b.initializer=a.view._createExecutor(b.initializer),b.initializer(c.extend({sandbox:this.options.sandbox,host:b.options.el?!1:this.$el,_name:d},b.options)))},a.view.base._destroyView=function(a){var b=this;if(c.isUndefined(a))c(this._views).each(function(a,c){b._destroyView(c)});else{var d=this.view(a);d&&(d.stopChildren&&d.stopChildren(),d.unsub&&d.unsub(),d.destroy&&d.destroy(),d.remove&&d.remove(),d.sandbox&&(d.sandbox=null),this._views[a]=null,delete this._views[a])}},a.view.base.view=function(a,b){var d=this;return c.isUndefined(b)?b=this._views[a]:(this._destroyView(a),b=this._views[a]=this._createSubview(b,a),c.chain(this._delayEvents).filter(function(b){return b.name===a}).each(function(a){d.listenTo(b,a.event,a.callback)})),b},a.view.base.active=function(a){var b,d=this;return c.isUndefined(a)?b=this.view(this._activeViewName):(this._activeViewName=a,b=this.view(this._activeViewName),c(this.switchable).each(function(a){d.view(a)&&d.view(a).hide()}),b.show(),this.trigger("activeView",this._activeViewName),void b.trigger("active"))},a.view.base._activeUI=function(){if(b.layout){setTimeout(function(){c.each(this.$("[data-part=layout]"),function(a){b(a).layout({applyDemoStyles:!1,closable:!1,resizable:!1,slidable:!1,spacing_open:0})})},0)}}}}),e("app/view/view-window",[],function(){return function(a){function b(a){a.find(".fn-s-loading").remove()}function c(a){var b=a.element.find(".fn-wnd");return 0===b.length?a.element:b}function d(a,d){if(0!==a.length){var e=c(d);h(a).each(function(a){a.options||(a.options={}),a.options.host=a.options.host?e.find(a.options.host):e,a.options.parentWnd=d}),this.startWidgets(a).done(function(){b(d.element)})}}function e(a,b){var d=this,e=c(b);h.each(a,function(a){var c=a.name;a.options=h.extend({host:e,parentWnd:b},a.options);var f=d.view(c,a);f.options.sandbox&&f.$el.addClass(f.options.sandbox.name),f._rendered?b.rendered(d):(f.listenTo(f,"rendered",function(){b.rendered(d)}),f.listenTo(f,"refresh-fail",function(){b.close()})),b.vToBeDestroyed[c]=f})}var f=a.core,g=a.core.$,h=a.core._,i=(g.noop,'<div class="fn-wnd fn-wnd-placeholder"><span class="ui-dialog-loading fn-s-loading">'+f.i18n.loadingText+"</span></div>");'<div class="k-footer"><button class="btn btn-default fn-close">'+f.i18n.windowCloseText+"</button></div>";a.view.base._windowInstance=function(c,d){var e=a.ui.dialog(g.extend({title:f.i18n.defaultDialogTitle,content:c,fixed:!0,drag:d.options.draggable},d.options)).close(),h={element:c,core:e,positionTo:d.positionTo,close:function(){this.core.remove()},destroy:function(){},center:function(){this.core.reset()},open:function(){d.options.modal===!0?this.core.showModal(this.positionTo):this.core.show(this.positionTo)},rendered:function(a){var c=a.$el.find(".footer");(c.length>0||d.footer===!0)&&c.addClass("modal-footer").closest(".ui-dialog-body").addClass("with-footer"),b(this.element),this.center()},setOptions:function(a){this.core.width(a.width).height(a.height).title(a.title)}};return h.core.addEventListener("remove",function(){g.each(g(".fn-wnd-placeholder:hidden"),function(a,b){0===g(b).closest(".ui-dialog").length&&g(b).remove()})}),h},a.view.base.viewWindow=function(a,b,c,d){return this.window(g.extend({name:"wnd_"+a,children:[{type:"view",name:a,initializer:b,options:c}]},d))},a.view.base.widgetWindow=function(a,b,c){return this.window(g.extend({name:"wnd_"+a,children:[{type:"widget",name:a,options:b}]},c))},a.view.base.windowName=function(){return h.uniqueId("wnd_")},a.view.base.htmlWindow=function(a,b,c){return this.window(g.extend({options:b,el:a},c))},a.view.base.window=function(a,c){var f=this,j=this._windows;if(h.isString(a))return j[a];if(j[a.name])return j[a.name];var k={name:"",type:"",el:null,center:!0,footer:!1,destroyedOnClose:!0,options:{animation:{open:!1,close:!1},width:300,height:200,resizable:!1,draggable:!1,show:!1,visible:!1,pinned:!1,modal:!1},children:null};a.positionTo&&(a.center=!1),c=null==c?!0:c,a=g.extend(!0,k,a),""===a.name&&(a.name=f.windowName());var l=h.isString(a.el)?g(i).html(a.el):g(null==a.el?i:a.el),m=this._windowInstance(l,a);if(m.vToBeDestroyed={},m.vLazyLayout=h.debounce(h.bind(function(){this.center()},m),300),m.core.addEventListener("beforeremove",h.bind(function(){this._destroyWindow(a.name)},this)),a.children){var n=[],o=[];h.each(a.children,function(b){var c=b.type||a.type;"view"===c&&o.push(b),"widget"===c&&n.push(b)}),e.call(this,o,m),d.call(this,n,m)}else b(m.element);return m&&(j[a.name]=m),a.center&&(m.center(),g(window).on("resize",m.vLazyLayout)),a.footer&&(l.find(".fn-close").on("click",function(){m.close()}),l.parents(".ui-dialog-body").addClass("with-footer")),c&&setTimeout(function(){m.open()},200),m},a.view.base._destroyWindow=function(a){var b=this,c=this._windows[a],d=c.element,e=this.options.sandbox.app;g.each(c.vToBeDestroyed,function(a,c){b._destroyView(a)}),e.widget.stop(d),g(window).off("resize",c.vLazyLayout),c.destroy?c.destroy():g(c).remove(),delete this._windows[a]}}}),e("app/view",["./view/view-mvvm","./view/view-view","./view/view-window"],function(a,b,c){return function(d){var e=d.core.$,f=d.core._,g=e.noop,h={className:"ver-view",template:null,defaults:{},views:null,aspect:g,subscribe:g,listen:g,enhance:g,init:g,initAttr:g,resize:g,delegateModelEvents:g,instance:g,_bind:g,_customDestory:g,switchable:[],initialize:function(a){var b=this;a||(a={}),this.binds=["resize"],this._rendered=!1,this._windows={},this._views={},this._delayEvents=[],this._attributes={},this.baseModel={},this.viewModel={},this._activeViewName=null,this._name=a._name,this.options=e.extend(!0,{autoAction:!1,autoRender:!0,autoResize:!1,autoCreateSubview:!0,domReady:!1,autoST:!1,toolbar:"toolbar",defaultToolbarTpl:".tpl-toolbar",lazyTemplate:!1,windowOptions:!1,sharedModel:null,sharedModelProp:null,langClass:null,bindEmptyModel:!1,activeView:null},this.defaults,a),this.binds&&(this.binds.unshift(this),f.bindAll.apply(f,this.binds)),d.core.util.extend(this,d.core.aspect),this._loadPlugin(),this.aspect(),this._defaultListen(),this.listen(),this.options.autoResize&&(this.listenTo(this,"rendered",function(){f.defer(b.resize)}),e(window).on("resize",this.resize)),null!=this.options.sharedModel&&this.model(this.shareModel(this.options.sharedModel),!1),this.options.parentWnd&&this.options.windowOptions&&(this.options.parentWnd.setOptions(this.options.windowOptions),this.options.parentWnd.config.center&&this.options.parentWnd.center()),this.initAttr(),this.subscribe(),this.init(),this._autoAction(),this.options.autoRender&&this._firstRender()},_defaultListen:function(){var a=this;this.listenTo(this,"modelBound",function(b){f(a._views).each(function(a){(a.options.sharedModel||a.options.sharedModelProp)&&a.model(a.shareModel(b))})}),this.listenTo(this,"rendering",function(){this.options.autoCreateSubview&&this._createSubviews()}),this.listenTo(this,"rendered",function(){this._bindViewModel(),this.options.autoST&&this.setTriggers()})},_autoAction:function(){this.options.autoAction&&(this.events||(this.events={}),e.extend(this.events,{"click [data-action]":"_actionHandler","click [data-view]":"_viewHandler","click [data-widget]":"_widgetHandler"}))},_loadPlugin:function(){var a=this.options.sandbox,b=a.app;this.options.plugin&&this.options.plugin.call(this),b.plugin&&b.plugin.execute(a.name,this)},attr:function(a,b){return f.isUndefined(b)||(this._attributes[a]=b,this.trigger("attr-change",a,b)),this._attributes[a]},replaceTpl:function(a,b,c){c?this.template=e("<div>"+this.template+"</div>").find(a).replaceWith(b).end().html():this.template=this.template.replace(a,b)},show:function(){var a=this;this.$el.show(!1,function(){a.options.autoResize&&a.resize()})},hide:function(){this.$el.hide(!1)},updateEl:function(a,b,c){var d=this.$(a);arguments.length>2?e.get(b,c).done(function(a){d.html(a)}):d.html(b)},_firstRender:function(){this.options.domReady?(this.enhance(),this.trigger("rendered")):this.render()},refresh:function(a,b){var c=this;null==a&&(a=f.result(this,"templateUrl")),this.loadingTemplate=!0,e.get(a,b).done(function(a){c.loadingTemplate=!1,f.isString(a)?(c._render(a,!0),c.trigger("refresh")):c.trigger("refresh-fail")}).fail(function(){c.options.parentWnd&&c.options.parentWnd.close()})},render:function(a){return a||(a=this.template),this.templateUrl?this.refresh():(this.options.el&&!a&&(a=f.unescape(this.$el.html())),this._render(a)),this},_render:function(a,b){var c=!!a,e=this.options,g=this.options.sandbox;if(c)if(b)this.$el.get(0).innerHTML=a;else{var h=f.isFunction(a)?a:f.template(a,{variable:"data"}),i=h(f.extend({lang:d.lang[this.options.langClass]},this.options));i&&(this.$el.get(0).innerHTML=i)}if(this.trigger("rendering"),this.options.host&&this._appended!==!0){var j=1===e._place?"prependTo":"appendTo";this.options._page&&this.options._page!==d.page.active()||(this.$el[j](this.options.host),this._appended=!0)}return g.log(this.cid+" rendered"),this._rendered=!0,this._activeUI(),this.enhance(),this.trigger("rendered"),this},listenToDelay:function(a,b,c){this._delayEvents.push({name:a,event:b,callback:c}),this.view(a)&&this.listenTo(this.view(a),b,c)},sub:function(a,b){this.options.sandbox.on(a,b,this,this.cid)},pub:function(){this.options.sandbox.emit.apply(this.options.sandbox,Array.prototype.slice.call(arguments))},unsub:function(){this.options.sandbox.stopListening(this.cid)},startWidgets:function(a){return this.options.sandbox.startWidgets(a,null,this.cid)},stopChildren:function(){this.options.sandbox.stopChildren(this.cid)},setTriggers:function(a){a||(a=this.options.defaultToolbarTpl);this.options.sandbox;this.pub("setTriggers",this.$(a).html(),this.options.toolbar||this._name,this)},_actionHandler:function(a,b){a.preventDefault(),b||(b=this);var c=e(a.currentTarget);if(!(c.closest("script").length>0)){var d=c.data().action;d.indexOf("Handler")<0&&(d+="Handler"),b[d]&&b[d](a)}},_getViewTriggerOptions:function(a){var b=a.split("?"),c=b[0],e={};return b[1]&&(e=d.core.util.qsToJSON(b[1])),e._viewName=c,e},_viewHandler:function(a){var b=e(a.currentTarget),c=this._getViewTriggerOptions(b.attr("data-view")),f=function(a){var b=d.view.ctor(a._viewName);return new b(a)};this.viewWindow(c._viewName,f,c)},_widgetHandler:function(a){var b=e(a.currentTarget),c=this._getViewTriggerOptions(b.attr("data-widget"));this.widgetWindow(c._viewName,c)},_destroy:function(){this.options.autoResize&&e(window).off("resize",this.resize),f(this._windows).each(function(a){a.close()}),this._destroyView(),this._customDestory(),this.viewModel=null,this.options.sandbox.log("destroyed")},destroy:function(){this._destroy()}},i={_ctors:{}};i.base=h,i._createExecutor=function(a){return f.isObject(a)&&!f.isFunction(a)?function(b){var c=b.sandbox.app,d=c.view.define(a);return new d(b)}:a},i.register=function(a,b){d.view._ctors[a]?d.core.logger.warn("View naming conflicts: "+a):d.view._ctors[a]=b},i.ctor=function(a){return d.view._ctors[a]},i.define=function(a,b,c){f.isBoolean(b)&&null==c&&(c=b,b=[]),null==c&&(c=!1),b||(b=[]),b.push(a);var g=d.core.View.extend(e.extend.apply(e,[!0,{},d.view.base].concat(b)));return a&&a.name&&d.view.register(a.name,g),c?function(a){return new g(a)}:g},d.view=i,a(d),b(d),c(d)}}),e("app/data",[],function(){return function(a){var b={_data:{}};b.get=function(a){return b._data[a]},b.set=function(c,d){b._data[c]=d,a.sandbox.emit("change."+c,d)},a.data=b}}),e("app/templates",["require"],function(a){return function(a){var b=a.core._;a.templates={_templates:{},set:function(b,c,d){d?d(["text!"+c],function(c){a.templates._templates[b]=c}):a.templates._templates[b]=c},get:function(b){return a.templates._templates[b]},getName:function(c){return b.each(a.templates._templates,function(a,b){return a===c?b:void 0}),null}}}}),e("app/router",[],function(){return function(b){var c=b.core._,d=c.throttle(function(a,c){b.page.change(a,c)},500),e={},f={routes:{"(/)":"entry","(/)?*params":"entry","page=:page":"openPage","(/)*page":"openPage","(/)*page?*params":"openPage","widget/:widget@:source":"executeWidget"},initialize:function(){},entry:function(a){d(b.config.homePage,a)},executeWidget:function(a,c){b.sandbox.startWidgets({name:a,options:{_source:c||"default",host:b.config.page.defaultHost}})},openPage:function(a,b){d(a,b)}};return e.base=f,e.create=function(c){var d=b.core.Router.extend(a.extend(!0,{},e.base,c));return new d},e.start=function(a){var c=e.create(a);return e.instance=c,b.core.history.start({pushState:!1}),c},e.navigate=function(a,b){e.instance.navigate(a,b)},b.router=e,e}}),e("app/ajax",[],function(){return function(a){var b=a.core.$,c={};c.get=function(a,c){return b.get(a,c)},c.getJSON=function(a,c){return b.getJSON(a,c)},c.getComplex=function(a,c,d){return d||(d={}),b.ajax(b.extend({url:a,type:"GET",contentType:"application/json",data:JSON.stringify(c)},d))},c.post=function(a,c){return b.post(a,c)},c.postComplex=function(a,c,d){return b.ajax(b.extend({url:a,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(c)},d))},a.request=c}}),e("app/hash",[],function(){return function(b){var c=function(b,c){function d(a){return"string"==typeof a||"[object String]"===Object.prototype.toString.call(a)}if(d(b)&&""!=b){b=encodeURIComponent(b);var e=new RegExp("(;"+b+"=[^;]*)|(\\b"+b+"=[^;]*;)|(\\b"+b+"=[^;]*)","ig"),f=new RegExp(";*\\b"+b+"=[^;]*","i");if("undefined"==typeof c){var g=location.hash.match(f);return g?decodeURIComponent(a.trim(g[0].split("=")[1])):null}if(null===c)location.hash=location.hash.replace(e,"");else{c+="";var h=location.hash.replace(e,"");h+=";"+b+"="+encodeURIComponent(c),location.hash=h}}};return c}}),!function(){function a(b){var d=c[b],e="exports";return"object"==typeof d?d:(d[e]||(d[e]={},d[e]=d.call(d[e],a,d[e],d)||d[e]),d[e])}function b(a,b){c[a]=b}var c={};b("jquery",function(){return jQuery}),b("popup",function(a){function b(){this.destroyed=!1,this.__popup=c("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body"),this.__backdrop=this.__mask=c("<div />").css({opacity:.7,background:"#000"}),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],d++}var c=a("jquery"),d=0,e=!("minWidth"in c("html")[0].style),f=!e;return c.extend(b.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(a){if(this.destroyed)return this;var d=this.__popup,g=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=a||this.follow,!this.__ready){if(d.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),e||c(window).on("resize",c.proxy(this.reset,this)),this.modal){var h={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||b.zIndex};d.addClass(this.className+"-modal"),f||c.extend(h,{position:"absolute",width:c(window).width()+"px",height:c(document).height()+"px"}),g.css(h).attr({tabindex:"0"}).on("focus",c.proxy(this.focus,this)),this.__mask=g.clone(!0).attr("style","").insertAfter(d),g.addClass(this.className+"-backdrop").insertBefore(d),this.__ready=!0}d.html()||d.html(this.innerHTML)}return d.addClass(this.className+"-show").show(),g.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(a){return!this.destroyed&&this.open&&(void 0!==a&&(this.returnValue=a),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove"),b.current===this&&(b.current=null),this.__popup.remove(),this.__backdrop.remove(),this.__mask.remove(),e||c(window).off("resize",this.reset),this.__dispatchEvent("remove");for(var a in this)delete this[a];return this},reset:function(){var a=this.follow;return a?this.__follow(a):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var a=this.node,d=this.__popup,e=b.current,f=this.zIndex=b.zIndex++;if(e&&e!==this&&e.blur(!1),!c.contains(a,this.__getActive())){var g=d.find("[autofocus]")[0];!this._autofocus&&g?this._autofocus=!0:g=a,this.__focus(g)}return d.css("zIndex",f),b.current=this,d.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(){var a=this.__activeElement,b=arguments[0];return b!==!1&&this.__focus(a),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(a,b){return this.__getEventListener(a).push(b),this},removeEventListener:function(a,b){for(var c=this.__getEventListener(a),d=0;d<c.length;d++)b===c[d]&&c.splice(d--,1);return this},__getEventListener:function(a){var b=this.__listener;return b||(b=this.__listener={}),b[a]||(b[a]=[]),b[a]},__dispatchEvent:function(a){var b=this.__getEventListener(a);this["on"+a]&&this["on"+a]();for(var c=0;c<b.length;c++)b[c].call(this)},__focus:function(a){try{this.autofocus&&!/^iframe$/i.test(a.nodeName)&&a.focus()}catch(b){}},__getActive:function(){try{var a=document.activeElement,b=a.contentDocument,c=b&&b.activeElement||a;return c}catch(d){}},__center:function(){var a=this.__popup,b=c(window),d=c(document),e=this.fixed,f=e?0:d.scrollLeft(),g=e?0:d.scrollTop(),h=b.width(),i=b.height(),j=a.width(),k=a.height(),l=(h-j)/2+f,m=382*(i-k)/1e3+g,n=a[0].style;n.left=Math.max(parseInt(l),f)+"px",n.top=Math.max(parseInt(m),g)+"px"},__follow:function(a){var b=a.parentNode&&c(a),d=this.__popup;if(this.__followSkin&&d.removeClass(this.__followSkin),b){var e=b.offset();if(e.left*e.top<0)return this.__center()}var f=this,g=this.fixed,h=c(window),i=c(document),j=h.width(),k=h.height(),l=i.scrollLeft(),m=i.scrollTop(),n=d.width(),o=d.height(),p=b?b.outerWidth():0,q=b?b.outerHeight():0,r=this.__offset(a),s=r.left,t=r.top,u=g?s-l:s,v=g?t-m:t,w=g?0:l,x=g?0:m,y=w+j-n,z=x+k-o,A={},B=this.align.split(" "),C=this.className+"-",D={top:"bottom",bottom:"top",left:"right",right:"left"},E={top:"top",bottom:"top",left:"left",right:"left"},F=[{top:v-o,bottom:v+q,left:u-n,right:u+p},{top:v,bottom:v-o+q,left:u,right:u-n+p}],G={left:u+p/2-n/2,top:v+q/2-o/2},H={left:[w,y],top:[x,z]};c.each(B,function(a,b){F[a][b]>H[E[b]][1]&&(b=B[a]=D[b]),F[a][b]<H[E[b]][0]&&(B[a]=D[b])}),B[1]||(E[B[1]]="left"===E[B[0]]?"top":"left",F[1][B[1]]=G[E[B[1]]]),C+=B.join("-")+" "+this.className+"-follow",f.__followSkin=C,b&&d.addClass(C),A[E[B[0]]]=parseInt(F[0][B[0]]),A[E[B[1]]]=parseInt(F[1][B[1]]),d.css(A)},__offset:function(a){var b=a.parentNode,d=b?c(a).offset():{left:a.pageX,top:a.pageY};a=b?a:a.target;var e=a.ownerDocument,f=e.defaultView||e.parentWindow;if(f==window)return d;var g=f.frameElement,h=c(e),i=h.scrollLeft(),j=h.scrollTop(),k=c(g).offset(),l=k.left,m=k.top;return{left:d.left+l-i,top:d.top+m-j}}}),b.zIndex=1024,b.current=null,b}),b("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"",innerHTML:'<div class="modal-dialog ui-dialog">    <div class="modal-content">        <div i="header" class="modal-header">            <button i="close" class="close" aria-hidden="true">×</button>            <h4 i="title" class="modal-title"></h4>        </div>        <div i="body" class="modal-body ui-dialog-body">            <div i="content" class="ui-dialog-content"></div>        </div>        <div i="footer" class="modal-footer">            <div i="statusbar" class="ui-dialog-statusbar"></div>            <div i="button" class="ui-dialog-button"></div>        </div>    </div></div>'}),b("dialog",function(a){var b=a("jquery"),c=a("popup"),d=a("dialog-config"),e=d.cssUri;if(e){var f=a[a.toUrl?"toUrl":"resolve"];f&&(e=f(e),e='<link rel="stylesheet" href="'+e+'" />',b("base")[0]?b("base").before(e):b("head").append(e))}var g=0,h=new Date-0,i=!("minWidth"in b("html")[0].style),j="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),k=!i&&!j,l=function(a,c,d){var e=a=a||{};("string"==typeof a||1===a.nodeType)&&(a={content:a,fixed:!j}),a=b.extend(!0,{},l.defaults,a),a.original=e;var f=a.id=a.id||h+g,i=l.get(f);return i?i.focus():(k||(a.fixed=!1),a.quickClose&&(a.modal=!0,a.backdropOpacity=0),b.isArray(a.button)||(a.button=[]),void 0!==d&&(a.cancel=d),a.cancel&&a.button.push({id:"cancel",value:a.cancelValue,callback:a.cancel,display:a.cancelDisplay}),void 0!==c&&(a.ok=c),a.ok&&a.button.push({id:"ok",value:a.okValue,callback:a.ok,autofocus:!0}),l.list[f]=new l.create(a))},m=function(){};m.prototype=c.prototype;var n=l.prototype=new m;return l.create=function(a){var d=this;b.extend(this,new c);var e=(a.original,b(this.node).html(a.innerHTML)),f=b(this.backdrop);return this.options=a,this._popup=e,b.each(a,function(a,b){"function"==typeof d[a]?d[a](b):d[a]=b}),a.zIndex&&(c.zIndex=a.zIndex),e.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",this.cancel===!1?"none":"").attr("title",this.cancelValue).on("click",function(a){d._trigger("cancel"),a.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),a.quickClose&&f.on("onmousedown"in document?"mousedown":"click",function(){return d._trigger("cancel"),!1}),this.addEventListener("show",function(){f.css({opacity:0,background:a.backdropBackground}).animate({opacity:a.backdropOpacity},150)}),this._esc=function(a){var b=a.target,e=b.nodeName,f=/^input|textarea$/i,g=c.current===d,h=a.keyCode;!g||f.test(e)&&"button"!==b.type||27===h&&d._trigger("cancel");
},b(document).on("keydown",this._esc),this.addEventListener("remove",function(){b(document).off("keydown",this._esc),delete l.list[this.id]}),g++,l.oncreate(this),this},l.create.prototype=n,b.extend(n,{content:function(a){var c=this._$("content");return"object"==typeof a?(a=b(a),c.empty("").append(a.show()),this.addEventListener("beforeremove",function(){b("body").append(a.hide())})):c.html(a),this.reset()},title:function(a){return this._$("title").text(a),this._$("header")[a?"show":"hide"](),this},width:function(a){return this._$("content").css("width",a),this.reset()},height:function(a){return this._$("content").css("height",a),this.reset()},button:function(a){a=a||[];var c=this,d="",e=0;return this.callbacks={},"string"==typeof a?(d=a,e++):b.each(a,function(a,f){var g=f.id=f.id||f.value,h="";c.callbacks[g]=f.callback,f.display===!1?h=' style="display:none"':e++,d+='<button type="button" i-id="'+g+'"'+h+(f.disabled?" disabled":"")+(f.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+f.value+"</button>",c._$("button").on("click","[i-id="+g+"]",function(a){var d=b(this);d.attr("disabled")||c._trigger(g),a.preventDefault()})}),this._$("button").html(d),this._$("footer")[e?"show":"hide"](),this},statusbar:function(a){return this._$("statusbar").html(a)[a?"show":"hide"](),this},_$:function(a){return this._popup.find("[i="+a+"]")},_trigger:function(a){var b=this.callbacks[a];return"function"!=typeof b||b.call(this)!==!1?this.close().remove():this}}),l.oncreate=b.noop,l.getCurrent=function(){return c.current},l.get=function(a){return void 0===a?l.list:l.list[a]},l.list={},l.defaults=d,l}),b("drag",function(a){var b=a("jquery"),c=b(window),d=b(document),e="createTouch"in document,f=document.documentElement,g=!("minWidth"in f.style),h=!g&&"onlosecapture"in f,i="setCapture"in f,j={start:e?"touchstart":"mousedown",over:e?"touchmove":"mousemove",end:e?"touchend":"mouseup"},k=e?function(a){return a.touches||(a=a.originalEvent.touches.item(0)),a}:function(a){return a},l=function(){this.start=b.proxy(this.start,this),this.over=b.proxy(this.over,this),this.end=b.proxy(this.end,this),this.onstart=this.onover=this.onend=b.noop};return l.types=j,l.prototype={start:function(a){return a=this.startFix(a),d.on(j.over,this.over).on(j.end,this.end),this.onstart(a),!1},over:function(a){return a=this.overFix(a),this.onover(a),!1},end:function(a){return a=this.endFix(a),d.off(j.over,this.over).off(j.end,this.end),this.onend(a),!1},startFix:function(a){return a=k(a),this.target=b(a.target),this.selectstart=function(){return!1},d.on("selectstart",this.selectstart).on("dblclick",this.end),h?this.target.on("losecapture",this.end):c.on("blur",this.end),i&&this.target[0].setCapture(),a},overFix:function(a){return a=k(a)},endFix:function(a){return a=k(a),d.off("selectstart",this.selectstart).off("dblclick",this.end),h?this.target.off("losecapture",this.end):c.off("blur",this.end),i&&this.target[0].releaseCapture(),a}},l.create=function(a,e){var f,g,h,i,j=b(a),k=new l,m=l.types.start,n=function(){},o=a.className.replace(/^\s|\s.*/g,"")+"-drag-start",p={onstart:n,onover:n,onend:n,off:function(){j.off(m,k.start)}};return k.onstart=function(b){var e="fixed"===j.css("position"),k=d.scrollLeft(),l=d.scrollTop(),m=j.width(),n=j.height();f=0,g=0,h=e?c.width()-m+f:d.width()-m,i=e?c.height()-n+g:d.height()-n;var q=j.offset(),r=this.startLeft=e?q.left-k:q.left,s=this.startTop=e?q.top-l:q.top;this.clientX=b.clientX,this.clientY=b.clientY,j.addClass(o),p.onstart.call(a,b,r,s)},k.onover=function(b){var c=b.clientX-this.clientX+this.startLeft,d=b.clientY-this.clientY+this.startTop,e=j[0].style;c=Math.max(f,Math.min(h,c)),d=Math.max(g,Math.min(i,d)),e.left=c+"px",e.top=d+"px",p.onover.call(a,b,c,d)},k.onend=function(b){var c=j.position(),d=c.left,e=c.top;j.removeClass(o),p.onend.call(a,b,d,e)},k.off=function(){j.off(m,k.start)},e?k.start(e):j.on(m,k.start),p},l}),b("dialog-plus",function(a){var b=a("jquery"),c=a("dialog"),d=a("drag");return c.oncreate=function(a){var c,e=a.options,f=e.original,g=e.url,h=e.oniframeload;if(g&&(this.padding=e.padding=0,c=b("<iframe />"),c.attr({src:g,name:a.id,width:"100%",height:"100%",allowtransparency:"yes",frameborder:"no",scrolling:"no"}).on("load",function(){var b;try{b=c[0].contentWindow.frameElement}catch(d){}b&&(e.width||a.width(c.contents().width()),e.height||a.height(c.contents().height())),h&&h.call(a)}),a.addEventListener("beforeremove",function(){c.attr("src","about:blank").remove()},!1),a.content(c[0]),a.iframeNode=c[0]),!(f instanceof Object))for(var i=function(){a.close().remove()},j=0;j<frames.length;j++)try{if(f instanceof frames[j].Object){b(frames[j]).one("unload",i);break}}catch(k){}b(a.node).on(d.types.start,"[i=title]",function(b){a.follow||(a.focus(),d.create(a.node,b))})},c.get=function(a){if(a&&a.frameElement){var b,d=a.frameElement,e=c.list;for(var f in e)if(b=e[f],b.node.getElementsByTagName("iframe")[0]===d)return b}else if(a)return c.list[a]},c}),window.dialog=a("dialog-plus")}(),e("art-dialog",["jquery"],function(a){return function(){var b;return b||a.dialog}}(this)),e("app/ui/dialog",["art-dialog"],function(a){return function(b){b.ui||(b.ui={}),b.ui.dialog=a,b.ui.confirm=function(a,b,c){window.confirm(a)?b&&b():c&&c()}}}),e("app/app",["../core/core","../core/application","./emitQueue","./page","./layout","./module","./navigation","./plugin","./sandboxes","./widget","./parser","./view","./data","./templates","./router","./ajax","./hash","./ui/dialog"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";return a.createApp=function(s){var t=a.$;a.$.extend;a.app&&a.app.stop();var u=new b(s);return c(u,b),i(u,b),j(u,b),k(u,b),l(u,b),p(u),m(u),n(u),q(u),t.inArray("dialog",u.config.features)>-1&&r(u),t.inArray("spa",u.config.features)>-1&&(d(u,b),e(u,b),f(u,b),g(u,b),o(u)),t.inArray("plugin",u.config.features)>-1&&h(u,b),a.app=u,u.sandbox=u.sandboxes.create(u.name,a.enums.hostType.APP),u.config.global&&(window.__verApp=u),u},a}),e("veronica",["./app/app"],function(a){"use strict";return a}),e("jquery",function(){return a}),e("underscore",function(){return _}),d("veronica")});