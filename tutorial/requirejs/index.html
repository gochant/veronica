<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>使用RequireJS - Veronica</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "tutorial\requirejs"
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Veronica</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">首页</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../changelog/">更新日志</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>教程</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../quickstart/">快速开始</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">使用RequireJS</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#requirejs">使用 RequireJS</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>主题</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../topics/concept/">深入理解一些概念</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Veronica</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">文档</a> &raquo;</li>
    
      
        
          <li>教程 &raquo;</li>
        
      
    
    <li>使用RequireJS</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="requirejs">使用 RequireJS</h1>
<p>通过这个教程，你可以基于 veronica 库创建一个可用的 web 应用程序，并简单了解该应用的执行逻辑</p>
<p>在我们的应用程序中，我们需要一个 HTML 页面，
最简单的情况下，它会是如下的样子： </p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;title&gt;Hello-veronica&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div data-ver-role=&quot;hello-veronica&quot; data-options='{ &quot;hi&quot;: &quot;Hello&quot;, &quot;name&quot;: &quot;Veronica!&quot;  }'&gt;
        &lt;%= data.hi %&gt; &lt;%= data.name %&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>只是一个符合html5标准的 页面，里面有个 <code>div</code>。</p>
<ul>
<li><code>data-ver-role</code> 指定该元素的部件名称</li>
<li><code>data-options</code> 指定实例化该部件传入的配置项</li>
</ul>
<p>接下来引入 RequireJS，通常放在页面底部</p>
<blockquote>
<p>我们所有的JS文件都按照AMD/UMD风格编写，同时使用 RequireJS 加载</p>
</blockquote>
<pre><code>&lt;script src=&quot;../bower_components/requirejs/require.js&quot;&gt;&lt;/script&gt;
</code></pre>

<p>编写自定义的代码</p>
<pre><code>    &lt;script&gt;
        require(['require-conf'], function (config) {
            // 设置 require.config
            require.config(config('../bower_components'));

            require(['veronica'], function (veronica) {

                // 创建 app
                var app = veronica.createApp();

                // 创建 widget: hello-veronica
                app.widget.register('hello-veronica', function (options) {
                    var app = options.sandbox.app;
                    var View = app.view.define();
                    return new View(options);
                });

                // 解析界面
                app.parser.parse();
            });

        });
    &lt;/script&gt;
</code></pre>

<p>这里为了便于维护和复用，我们把 requirejs 的配置放到单独的文件中进行管理，命名为 require-conf，它类似与
下面的样子：</p>
<pre><code>// requirejs
(function (root, factory) {
    if (typeof define === 'function' &amp;&amp; define.amd) {
        // AMD
        define(function () {
            return factory();
        });
    } else if (typeof exports === 'object') {
        // Node.js
        module.exports = factory();
    } else {
        // Browser globals
        root.Backbone = factory();
    }
}(this, function () {

    return function (framePath) {
        require.config({
            debug: true,
            paths: {
                'underscore': framePath + '/underscore/underscore',
                'jquery': framePath + '/jquery/jquery',
                'eventemitter': framePath + '/eventemitter2/lib/eventemitter2',
                'text': framePath + '/requirejs-text/text',
                'css': framePath + '/require-css/css',
                'normalize': framePath + '/require-css/normalize',
                'css-builder': framePath + '/require-css/css-builder'
            },
            shim: {
                'underscore': { 'exports': '_' },
                'jquery': { 'exports': 'jquery' }
            },
            packages: [{ name: 'veronica', location: '../lib' }]
        });
    }

}));

</code></pre>

<p>这种写法与标准的AMD模块有些不同，称之为 <a href="https://github.com/umdjs/umd">UMD</a> 模式，它能兼容 RequireJS、NodeJS和普通的全局浏览器环境，这便于我们在 Grunt 中（NodeJS环境）对该配置文件进行读取</p>
<p>由于 requirejs 配置文件的单独放置，因此我们需要在配置文件真正请求并加载后，才能编写应用相关的代码。</p>
<p>require-conf 文件里面通过 package 方式配置 veronica 的路径，否则会出现 404 错误，如下所示：</p>
<pre><code class="js">packages: [{
    name: 'veronica', location: framePath + '/veronica/lib'
}
</code></pre>

<blockquote>
<p>由于框架项目是个多文件项目，因此如果你直接引用 <code>lib</code> 文件夹里的源代码，那么应该使用 packages 配置项，
而不是 paths，这样整个项目会被当成一个包加载，并能正确的解析文件之间的依赖关系。其他多文件的工程项目，也应
使用这种方式配置。</p>
</blockquote>
<p><strong>几个API</strong></p>
<ul>
<li>createApp</li>
</ul>
<p>创建应用程序是最开始做的工作，这个方法接收两个参数：应用程序名和应用程序配置项，多次调用该方法会销毁上一个app，并创建新的app</p>
<ul>
<li>app.widget.register</li>
</ul>
<p>注册一个部件</p>
<ul>
<li>app.parser.parse</li>
</ul>
<p>解析界面，该方法会查找界面上声明的widget，并实例化它</p>
<p>以上代码运行的结果是在界面上呈现了一段简单的字符串：  hello veronica</p>
<p><strong>完整的代码</strong></p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;simpe page&lt;/title&gt;
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=UTF-8&quot; /&gt;
    &lt;style&gt;
        /*为了避免界面一开始闪烁*/
        [data-ver-role] {
            display: none;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div data-ver-role=&quot;hello-veronica&quot; data-options='{ &quot;hi&quot;: &quot;Hello&quot;, &quot;name&quot;: &quot;Veronica!&quot;  }'&gt;
        &lt;%= data.hi %&gt; &lt;%= data.name %&gt;
    &lt;/div&gt;
    &lt;script src=&quot;../bower_components/requirejs/require.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        require(['require-conf'], function (config) {
            // 设置 require.config
            require.config(config('../bower_components'));

            require(['veronica'], function (veronica) {

                // 创建 app
                var app = veronica.createApp();

                // 创建 widget: hello-veronica
                app.widget.register('hello-veronica', function (options) {
                    var app = options.sandbox.app;
                    var View = app.view.define();
                    return new View(options);
                });

                // 解析界面
                app.parser.parse();
            });

        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../topics/concept/" class="btn btn-neutral float-right" title="深入理解一些概念"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../quickstart/" class="btn btn-neutral" title="快速开始"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../quickstart/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../topics/concept/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
